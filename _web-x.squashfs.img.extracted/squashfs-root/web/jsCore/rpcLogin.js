function checkLoginStr(b){if(b.indexOf('"')>-1||b.indexOf("\\")>-1){for(var e=b.length,h="",d="",g=0;g<e;g++){d=b.slice(g,g+1);if(d=='"'||d=="\\")d="\\"+d;h+=d}b=h}return b}function encryptIpcUserName(b){var e="";if(b.length>8)var h=b.substr(0,1).charCodeAt()+3,e=String.fromCharCode(h)+b.substr(1,b.length);else for(var d=0;d<b.length;d++)h=b.substr(d,1).charCodeAt()+3,e+=String.fromCharCode(h);return e}
var RPCLogin=new Class({Extends:RPCCall,login:function(b,e,h,d){var g=checkLoginStr(b);checkLoginStr(e);var i=0,c=function(a){a=JSON.decode(a);a.result?(i=1,h(b,e)):(a=a.params.error,i=a=="PasswordNotValid"?-1:a=="UserNotValidt"?-2:a=="HasBeenLocked"?-3:a=="InBlackList"?-4:a=="HasBeedUsed"?-5:-6,rpcCore.sessionID=0)};sendRequest(d==void 0?'{"method":"global.login","params":{"userName":"'+g+'","password":"","clientType":"Web3.0"},"id":10000}':'{"method":"global.login","params":{"userName":"'+g+'","password":"","loginType":"'+
d+'","clientType":"Web3.0"},"id":10000}',function(a){var f=JSON.decode(a).error.code;f==401?(f=JSON.decode(a).session,rpcCore.sessionID=f+"",Cookie.write("DhWebClientSessionID",f,{duration:0,path:"/"}),f=JSON.decode(a).params.encryption,f=="Basic"?a=Base64.encode(b+":"+e):f=="Default"?(f=JSON.decode(a).params.realm,a=JSON.decode(a).params.random,f=hex_md5(b+":"+f+":"+e),a=hex_md5(b+":"+a+":"+f)):(f=="WatchNet"&&(d="WatchNet",b=encryptIpcUserName(b)),a=e),sendRequest(d==void 0?'{"method":"global.login","session":'+
rpcCore.sessionID+',"params":{"userName":"'+g+'","password":"'+a+'","clientType":"Web3.0"},"id":10000}':'{"method":"global.login","session":'+rpcCore.sessionID+',"params":{"userName":"'+g+'","password":"'+a+'","loginType":"'+d+'","clientType":"Web3.0"},"id":10000}',c,!1,"/RPC2_Login")):i=f==400?-2:f==486?-7:0},!1,"/RPC2_Login");return i},logout:function(b){b==void 0&&(b=!0);rpcCore.sessionID!=0&&sendRequest('{"method" : "global.logout","params" : null,"session":'+rpcCore.sessionID+',"id" : 10001}',
function(){},b)},loginDVR:function(b,e,h){var d=0,g=e,i=function(c){c=JSON.decode(c);c.result?(d=1,h(b,g)):(c=c.error.code,d=c==268632071?-1:c==268632070?-2:c==268632072?-3:c==268632073?-4:c==268632074?-5:c==268632075?-7:-6,Cookie.dispose("DhWebClientSessionID"))};sendRequest('{"method":"global.login","params":{"userName":"'+b+'","password":"","clientType":"Web3.0"},"id":10000}',function(c){var a=JSON.decode(c).error.code;a==268632079?(a=JSON.decode(c).session,Cookie.write("DhWebClientSessionID",
a,{duration:0,path:"/"}),a=JSON.decode(c).params.encryption,a=="Basic"?c=Base64.encode(b+":"+e):a=="Default"?(a=JSON.decode(c).params.realm,c=JSON.decode(c).params.random,a=hex_md5(b+":"+a+":"+e),c=hex_md5(b+":"+c+":"+a),g=a):c=e,c='{"method":"global.login","session":'+Cookie.read("DhWebClientSessionID")+',"params":{"userName":"'+b+'","password":"'+c+'","clientType":"Web3.0"},"id":10000}',sendRequest(c,i,!1,"/RPC2_Login")):d=a==268632075?-7:0},!1,"/RPC2_Login");return d}});
