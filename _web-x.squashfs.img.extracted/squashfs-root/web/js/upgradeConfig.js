(function(){var a=Page.upgradeConfig={init:function(){if(Browser.Engine.trident||Browser.Engine.webkit)$("dahuaupgrade").style.display="inline-block";a.upgrader=new Upgrader;a.translate();a.render();a.bind()},translate:function(){$("upgrade").set("text",tl("w_Firmware Upgrade"));$("upgrade_import_label").set("text",tl("w_Import Upgrade"));$("upgrade_import").set("text",tl("w_Import"));$("upgrade_update").set("text",tl("w_Upgrade"));$("upgrade_updating").set("text",tl("w_updating,please wait."));$("upgrade_help").set("title",
tl("w_help"))},render:function(){$("upgrade_path").value="";Cookie.write("DhWebClientSessionID",rpcCore.sessionID,{duration:0,path:"/"})},bind:function(){$("upgrade_import").addEvent("click",function(){$("dahuaupgrade").click();this.blur()});$("upgrade_update").addEvent("click",a._onUpdateClick);$("dahuaupgrade").addEvent("change",a._onDahuaUpgradeChange);$("dahuaupgrade").addEvent("blur",a._onDahuaUpgradeChange);$("dahuaupgrade").addEvent("mouseover",function(){$("upgrade_import").addClass("ui-button-hover");
var a=this.value||"No File";$("dahuaupgrade").set("title",a)});$("dahuaupgrade").addEvent("mouseout",function(){$("upgrade_import").removeClass("ui-button-hover")});$("upgrade_help").addEvent("click",function(){openHelp("upgradeConfig.htm")});$("openAmcrest").addEvent("click",function(){window.open("http://amcrest.com/firmware")})},_onDahuaUpgradeChange:function(){var a=this.value.split("\\");$("upgrade_path").setProperty("value",a[a.length-1])},_onUpdateClick:function(){var a=$("dahuaupgrade").value;
$("upgrade_path").value!==""&&(a.test(".bin","i")?(Cookie.write("DhWebClientSessionID",rpcCore.sessionID,{duration:0,path:"/"}),function(){$("upgrade_update").removeEvents("click").addClass("ui-button-disabled");$("upgrade_submit").click();$("upgrade_probar").style.visibility="visible";$("upgrade_process").style.width="25px"}.delay(100)):remarkDisplay("upgrade_remark",tl("Bad file format!"),3E3,2))},_getStatus:function(){a.upgrader.getStatus(a._getStatusSuccess,a._getStatusFails)},_getStatusSuccess:function(b){b=
JSON.decode(b);if(b.result)switch(b.params.State){case "Invalid":a._state.badFile();break;case "Failed":case "NotEnoughMemory":case "Cancelled":a._state.upgradeFailed();break;case "FileUnmatch":a._state.fileUnmatch();break;default:a._state.upgrading(b.params.Progress)}else remarkDisplay("upgrade_remark",tl("Operateingfailure"),3E3,2),$("upgrade_update").addEvent("click",a._onUpdateClick).removeClass("ui-button-disabled"),$("upgrade_probar").style.visibility="hidden"},_state:{badFile:function(){a._upgradeFails("w_badFiletoReboot")},
fileUnmatch:function(){a._upgradeFails("w_FileUnmatch")},upgradeFailed:function(){a._upgradeFails("w_Upgradefailed")},upgrading:function(b){b<10&&(b=10);$("upgrade_process").style.width=b*251/100+"px";b==100?($("upgrade_updating").setProperty("text",tl("w_Rebooting...")),a._locationToIndex.delay(2E4)):a._getStatus.delay(1E3)}},_getStatusFails:function(){$("upgrade_process").style.width="251px";$("upgrade_updating").setProperty("text",tl("w_Rebooting..."));a._locationToIndex.delay(2E4)},_locationToIndex:function(){window.removeEvents("unload");
window.removeEvents("beforeunload");window.location="/"},_upgradeFails:function(b){$("upgrade_update").addEvent("click",a._onUpdateClick).removeClass("ui-button-disabled");$("upgrade_probar").style.visibility="hidden";isNeedReboot('{"result":true,"params":{"options":["NeedReboot"]}}',b,!0,!0)}}})();function downSucceed(){Page.upgradeConfig._getStatus()};
