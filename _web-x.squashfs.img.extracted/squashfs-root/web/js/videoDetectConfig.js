(function(){var m=["BlindDetect"];(function(){var j=Page.videoDetectConfig={Tab:[],init:function(){j.Tab.motionDetect.init();j.Tab.blindDetect.init();j.translate();j.bind();j.render()},translate:function(){SensorInfo=="Normal"?$("videoDetect_motion").set("text",tl("w_Motion Detect")):$("videoDetect_motion").set("text",tl("w_Motion Detection"));$("videoDetect_help").set("title",tl("w_help"));$("videoDetect_sun").set("text",tl("w_Sunday"));$("videoDetect_mon").set("text",tl("w_Monday"));$("videoDetect_tue").set("text",
tl("w_Tuesday"));$("videoDetect_wen").set("text",tl("w_Wednesday"));$("videoDetect_thu").set("text",tl("w_Thursday"));$("videoDetect_fri").set("text",tl("w_Friday"));$("videoDetect_sat").set("text",tl("w_Saturday"));$("videoDetect_titleday0").set("text",tl("w_Sunday"));$("videoDetect_titleday1").set("text",tl("w_Monday"));$("videoDetect_titleday2").set("text",tl("w_Tuesday"));$("videoDetect_titleday3").set("text",tl("w_Wednesday"));$("videoDetect_titleday4").set("text",tl("w_Thursday"));$("videoDetect_titleday5").set("text",
tl("w_Friday"));$("videoDetect_titleday6").set("text",tl("w_Saturday"));for(var g=0;g<6;g++)$("videoDetect_tmsection"+g).set("text",tl("w_Time"+(g+1)));$$("a[id^=videoDetect_tmset]").set("text",tl("w_Setup"));$("videoDetect_titleaweek").set("text",tl("w_Weekall"));$("videoDetect_timeCancle0").set("text",tl("w_Cancel"));$("videoDetect_timeConfirm0").set("text",tl("w_Confirm"));$("videoDetect_close").set("text",tl("w_Cancel"));$("videoDetect_flashLanchDelayTitle").set("text",tl("w_flashDelay"));$("flash_alarmCap").set("text",
tl("w_led"));$("videoDetect_flash_second").set("text",tl("w_Second"))},render:function(){$$(".videoDetect_tab_title.ui-tab-current").fireEvent("click")},bind:function(){$$(".videoDetect_tab_title").addEvent("click",j._onTabTitleClick);$("videoDetect_help").addEvent("click",j._openHelp);$("videoDetect_allweek").addEvent("click",j._onAllWeekClick);attachTimeEvent("videoDetect_t0");attachTimeEvent("videoDetect_t1");attachTimeEvent("videoDetect_t2");attachTimeEvent("videoDetect_t3");attachTimeEvent("videoDetect_t4");
attachTimeEvent("videoDetect_t5");for(var g=0;g<7;g++)$("videoDetect_day"+g).addEvent("click",j._checkWeekClick)},_onTabTitleClick:function(){var g=this.getProperty("data-for");j.Tab[g].render();$$(".videoDetect_tab_title").removeClass("ui-tab-current");$$(".videoDetect_tab_con").setStyle("display","none");this.addClass("ui-tab-current");$("videoDetect_tab_"+g).setStyle("display","block")},_openHelp:function(){openHelp("videoDetectConfig.htm")},_onAllWeekClick:function(){for(var g=0;g<7;g++)$("videoDetect_day"+
g).disabled?$("videoDetect_day"+g).checked=!0:$("videoDetect_day"+g).checked=this.checked},_checkWeekClick:function(){$("videoDetect_allweek").checked=$("videoDetect_day0").checked&&$("videoDetect_day1").checked&&$("videoDetect_day2").checked&&$("videoDetect_day3").checked&&$("videoDetect_day4").checked&&$("videoDetect_day5").checked&&$("videoDetect_day6").checked},logout:function(){j.Tab.motionDetect.logout()}}})();(function(){function j(c){for(var s=8191/18,a=8191/22,e=c[0].MotionDetectWindow,d=
n.MotionDetectWindow,g=[],f=[],h=c=0,k=0,j=0,l=0;l<18;l++){for(var m=e[0].Region[l],o=1;o<d;o++)m|=e[o].Region[l];g[l]=m}for(d=e=0;d<18;d++)e|=g[d],!c&&g[d]>0&&(c=d+1);for(d=17;d>=0;d--)if(g[d]>0){h=d+1;break}g=e.toString(2);g!=0&&(k=22-g.length,j=k+g.lastIndexOf("1")+1);c>0&&c--;f[0]=Math.floor(a*k);f[1]=Math.floor(s*c);f[2]=Math.ceil(a*j);f[3]=Math.ceil(s*h);b.configManager.getConfig("ThermographyOptions",function(c,s){if(s.result)flirJson=s.params.table,flirJson[0][0].OptimizedRegion.Regions=[],
flirJson[0][0].OptimizedRegion.Regions[0]=f,b.configManager.setConfig("ThermographyOptions",flirJson,function(){})})}var g=null,r=null,h,q={},f={},d=["None","Preset","Tour","Pattern"],a=0,e=null,k=-1,l=-1,o=[],t=null,u=0,n={},w=58,x=4,v=null,p={id:-1,timer:null,number:0,threshold:0,canvas:$("videoDetect_MotionFigure"),line:$("videoDetect_MotionFigure_threshold"),add:function(c){var b=document.createElement("div");b.className=c.threshold>this.threshold?"motion":"";b.style.height=c.threshold+"px";b.style.left=
this.number+"px";this.canvas.appendChild(b)},move:function(){this.number++;this.canvas.setStyle("left",240-this.number);this.number>=240&&this.canvas.getElement("div").dispose();this.line.setStyle("bottom",this.threshold+1)},clear:function(){this.canvas.setStyle("left",240);this.canvas.getElements("div").dispose();this.number=0},stop:function(){this.clear();$clear(this.timer)}},b=Page.videoDetectConfig.Tab.motionDetect={init:function(){b.dialog1=new Dialog("videoDetect_setTimeTable",function(){},
"videoDetect_timeConfirm0","videoDetect_timeCancle0",tl("w_TimeAlarmPeriod"));b.dialog2=new Dialog("videoDetect_zone",b._saveZone,"videoDetect_savezone","videoDetect_close",tl("w_Setting Area"));b.dialog1.setPosition(200,3);b.dialog2.setPosition(200,3);b.configManager=new ConfigManager;b.ptzCtrl=new PtzCtrl;b.magicBox=new MagicBox;b.devVideoDetect=new DevVideoDetect;b.translate();b.bind();b._SliderInit();b._getCaps();localPngHash.videodetect_default_sensitive!==void 0&&(w=localPngHash.videodetect_default_sensitive-
0);localPngHash.videodetect_default_threshold!==void 0&&(x=localPngHash.videodetect_default_threshold-0)},translate:function(){$("videoDetect_title_able0").set("text",tl("w_StartUp"));$("videoDetect_videoInput0").set("text",tl("w_VideoInput"));$("videoDetect_workPeriod0").set("text",tl("w_TimeAlarmPeriod"));$("videoDetect_tab_motionDetect").getElements("span[name=t_sec]").each(function(c){c.setProperty("text",tl("w_Second"))});$("videoDetect_anti0").set("text",tl("w_RemoveDither"));$("videoDetect_sensitivity0").set("text",
tl("w_Sensitivity"));$("videoDetect_setzone").set("text",tl("w_Setting Area"));$("videoDetect_recordChannel0").set("text",tl("w_RecordChannel"));$("videoDetect_recordDelay0").set("text",tl("RecordLatch"));$("videoDetect_alarmOut0").set("text",tl("w_Alarm Out"));$("videoDetect_alarmDelay0").set("text",tl("AlarmOutLatch"));$("videoDetect_emailTitle0").set("text",tl("w_Send E-Mail"));$("videoDetect_ptzTitle0").set("text",tl("w_PtzLink"));$("videoDetect_linkTitle0").set("text",tl("w_LinkWork"));var c=
$("videoDetect_linkSelect0").getElements("option");c[0].setProperty("text",tl("w_none"));c[1].setProperty("text",tl("w_Preset"));c[2].setProperty("text",tl("w_Tour"));c[3].setProperty("text",tl("w_Pattern"));$("videoDetect_address0").set("text",tl("w_ptzAddress"));$("videoDetect_snapTitle0").set("text",tl("w_Snap"));$("videoDetect_default0").set("text",tl("w_DefaultConfig"));$("videoDetect_refresh0").set("text",tl("w_Refresh"));$$("#videoDetect_confirm0,#videoDetect_savezone").set("text",tl("w_Confirm"));
$("videoDetect_clear").set("text",tl("w_Removeall"));$("videoDetect_del").set("text",tl("w_Delete"));$("videoDetect_title").set("text",tl("w_(Or press right button of mouse)"));$("videoDetect_sendnoteTitle0").set("text",tl("w_noteLink"));$("videoDetect_Sensitive_label").set("text",tl("w_Sensitivity"));$("videoDetect_Threshold_label").set("text",tl("w_Threshold"));$$("#videoDetect_setButton0,#videoDetect_setzoneButton").set("text",tl("w_Setup"));$$("#videoDetect_setTimeTable h1").set("text",tl("w_TimeAlarmPeriod"));
$$("#videoDetect_zone h1").set("text",tl("w_Setting Area"));$("videoDetect_region_label").set("text",tl("w_window"));$("videoDetect_region_name_label").set("text",tl("w_Name"));n.UnFocusDetect?($("videoDetect_blind").set("text",tl("w_videoOn")),$("videoDetect_ableTitle1").set("text",tl("w_VideoShelterEnable"))):($("videoDetect_blind").set("text",tl("w_Video Shelter")),$("videoDetect_ableTitle1").set("text",tl("w_StartUp")))},render:function(){if(ALARM_FLASH)$("videoDetect_flash_light").style.display=
"",$("videoDetect_flashLanchDelay").style.display="";$("videoDetect_timeConfirm0").removeEvents("click").addEvent("click",b._saveTimePeriod);$$("#page_videoDetectConfig a[id^=videoDetect_tmset]").removeEvents("click").addEvent("click",function(){var c=this.id.replace(/[^\d]/g,"");b._putTimePeriod(c)});b.dialog1.close();b.dialog2.close();b._renderInitPage();b.ptzCtrl.getCurrentProtocolCaps(function(c){if(JSON.decode(c).result&&JSON.decode(c).params)e=JSON.decode(c).params.caps,$("videoDetect_linkSelect0").innerHTML=
"",$("videoDetect_linkSelect0").options.add(new Option(tl("w_none"),1)),e.Preset!==!1&&$("videoDetect_linkSelect0").options.add(new Option(tl("w_Preset"),2)),e.Tour!==!1&&$("videoDetect_linkSelect0").options.add(new Option(tl("w_Auto-Tour"),3)),e.Pattern!==!1&&$("videoDetect_linkSelect0").options.add(new Option(tl("w_Pattern"),4))},0,!1);hasPtz&&e&&e.Type?$("videoDetect_ptzLink1").setStyle("display",""):$("videoDetect_ptzLink1").setStyle("display","none");b.configManager.getConfig("MotionDetect",
function(c){g=JSON.decode(c).params.table;r=$unlink(g);b._renderElements()});if(isEnable("is_has_detectPic"))$("videoDetect_MotionFigure_wrap").style.display="block";b._takeAttachMotion();$("videoDetect_chartZone").removeEvents();b.schedule=new Schedule("videoDetect_chartZone",{type:"general",onChange:function(){b._putTimePeriod(b.schedule._day)}})},bind:function(){attachLimit("videoDetect_flashLanchDelayTime",10,300);$("videoDetect_default0").addEvent("click",b._onDefaultClick);$("videoDetect_refresh0").addEvent("click",
b._onRefreshClick);$("videoDetect_confirm0").addEvent("click",b._onConfirmClick);$("videoDetect_setButton0").addEvent("click",b._onSetupClick);$("videoDetect_setzoneButton").addEvent("click",b._setZoneClick);$("videoDetect_setzoneButton").addEvent("click",b._onFigureOpen);$$("#videoDetect_savezone, #videoDetect_close, #videoDetect_zone .exit a").addEvent("click",b._onFigureClose);attachLimit("videoDetect_antiInput0",0,100);attachLimit("videoDetect_recordDelayInput0",10,300);attachLimit("videoDetect_alarmDelayInput0",
10,300);$("videoDetect_addressInput0").addEvents({keyup:function(){b._ptzLinkKeyUp()},blur:function(){if(this.value=="")switch($("videoDetect_linkSelect0").selectedIndex){case 1:this.value=e.PresetMin;break;case 2:this.value=e.TourMin;break;case 3:this.value=e.PatternMin}else b._ptzLinkKeyUp()}});$("videoDetect_clear").addEvent("click",function(){b._clrArea()});$("videoDetect_del").addEvent("click",b._delArea);$("videoDetect_linkSelect0").addEvent("change",b._onLinkChange);$("videoDetect_ptzCheck0").addEvent("click",
b._ptzCheckClick);$$(".videodetect-region-item").addEvent("click",function(){k=this.get("data-id")-0;l=this.get("data-index")-0;try{$("ocx")&&$("ocx").SetCurrentDrawId(k)}catch(c){}$$(".videodetect-region-item").removeClass("videodetect-region-current");this.addClass("videodetect-region-current");a=1;$("videoDetect_region_name").value=h[0].MotionDetectWindow[l].Name;q.set(h[0].MotionDetectWindow[l].Sensitive);f.set(h[0].MotionDetectWindow[l].Threshold);a=0});$("videoDetect_region_name").addEvents({keyup:function(){if(this.value.test(/[:"'{}\[\]<>\\,]/g))this.value=
this.value.replace(/[:"'{}\[\]<>\\,]/g,"")},blur:function(){if(this.value.test(/[:"'{}\[\]<>\\,]/g))this.value=this.value.replace(/[:"'{}\[\]<>\\,]/g,"");h[0].MotionDetectWindow[l].Name=this.value}});$$("#videoDetect_setTimeTable .ui-dialog-icon, #videoDetect_timeCancle0").addEvent("click",function(){if($("videoDetect_motion")&&$("videoDetect_motion").hasClass("ui-tab-current")&&v)g[0].EventHandler.TimeSection=Array.clone(v),v=null})},_takeAttachMotion:function(){var c=0,a=!1,d=!1;isEnable("is_has_detectPic")&&
($clear(c),c=setInterval(function(){Site.currentPage.is.videoDetectConfig&&$("videoDetect_motion").hasClass("ui-tab-current")?d||(u=(u+1)%65536,b.devVideoDetect.attachMotionData(function(c,b){a=b.result},u,!1),d=!0):(d&&a&&(b.devVideoDetect.detachMotionData(function(){},u,!0),d=!1),$clear(c))},1E3))},_renderInitPage:function(){bool_4g||bool_get4GNet?$("videoDetect_note0").setStyle("display",""):bool_get3GNet&&bool_3g?$("videoDetect_note0").setStyle("display",""):$("videoDetect_note0").setStyle("display",
"none");ALARM_OUT_NUMBER==0?$$("#videoDetect_alarmO1,#videoDetect_alarmO2").setStyle("display","none"):$$("#videoDetect_alarmO1,#videoDetect_alarmO2").setStyle("display","");CHANNEL_NUMBER<=1?$("videoDetect_video0").setStyle("display","none"):alert("DVR")},_getCaps:function(){var c=null;b.devVideoDetect.instance(0,function(b,a){c=a.result},!1);b.devVideoDetect.getCaps(c,function(c,b){b.result?(n=b.params.caps,n.UnFocusDetect?(m=["BlindDetect","UnFocusDetect"],$$(".videoDetect_UnFocus").setStyle("display",
""),$("videoDetect_blind").set("text",tl("w_videoOn")),$("videoDetect_ableTitle1").set("text",tl("w_VideoShelterEnable"))):(m=["BlindDetect"],$$(".videoDetect_UnFocus").setStyle("display","none"),$("videoDetect_blind").set("text",tl("w_Video Shelter")),$("videoDetect_ableTitle1").set("text",tl("w_StartUp"))),n.SupportBlind||$("videoDetect_blind").setStyle("display","none")):(n={DetectVersion:["V1.0","V3.0"],MotionColumns:22,MotionDetectWindow:4,MotionResult:0,MotionRows:18,SupportBlind:1,SupportLoss:1,
SupportMotion:1},$$(".videoDetect_UnFocus").setStyle("display","none"))},!1)},_renderElements:function(){var c=g[0],a=c.EventHandler,f="";$("videoDetect_select_sensitivity").value=c.Level;$("videoDetect_antiInput0").value=a.Dejitter;if(ALARM_OUT_NUMBER>1){for(var h=0;h<ALARM_OUT_NUMBER;h++)f+='<a href="javascript:;" class="ui-channel-item videoDetect_alarmOut"  id="videoDetect_alarmOut_0_'+h+'">'+(h+1)+"</a>";$("videoDetect_alarmOutAdd0").innerHTML=f;$$(".videoDetect_alarmOut").addEvent("click",function(){var c=
this.id.split("_");b._renderAlarmOut(c[3],c[2])});for(var f=a.AlarmOutChannels.length,h=a.AlarmOutChannels,k=0;k<f;k++)$("videoDetect_alarmOut_0_"+h[k]).addClass("ui-channel-item-current")}$("videoDetect_able0").checked=c.Enable;if(a.Delay==void 0)a.Delay=0;if(ALARM_FLASH)$("videoDetect_alarmCap").checked=a.FlashEnable,$("videoDetect_flashLanchDelayTime").value=a.FlashLatch;$("videoDetect_record0").checked=a.RecordEnable;$("videoDetect_recordDelayInput0").value=a.RecordLatch;$("videoDetect_almout0").checked=
a.AlarmOutEnable;$("videoDetect_alarmDelayInput0").value=a.AlarmOutLatch;$("viedoDetect_email0").checked=a.MailEnable;$("videoDetect_snap0").checked=a.SnapshotEnable;$("videoDetect_ptzCheck0").checked=a.PtzLinkEnable;if(a.PtzLink.length==0)a.PtzLink=[["None",1]];c=a.PtzLink[0];f=d.indexOf(c[0]);$("videoDetect_linkSelect0").selectedIndex=f;$("videoDetect_addressInput0").value=c[1];if(e!=null)switch(f){case 1:c[1]>e.PresetMax?$("videoDetect_addressInput0").value=e.PresetMax:$("videoDetect_addressInput0").value=
c[1];break;case 2:c[1]>e.TourMax?$("videoDetect_addressInput0").value=e.TourMax:$("videoDetect_addressInput0").value=c[1];break;case 3:c[1]>e.PatternMax?$("videoDetect_addressInput0").value=e.PatternMax:$("videoDetect_addressInput0").value=c[1]}b._ptzCheckClick();a.MMSEnable?$("videoDetect_sendnote0").checked=a.MMSEnable:$("videoDetect_sendnote0").checked=!1},_SliderInit:function(){q=new FineSlider("videoDetect_Sensitive_line","videoDetect_Sensitive_icon",{range:[0,100],wheel:!1,onChange:function(c){$("videoDetect_Sensitive_line").setProperty("title",
c);$("videoDetect_Sensitive_title").setProperty("text",c)},onComplete:function(c){h[0].MotionDetectWindow[l].Sensitive=c-0;b._setTempConfig()}},"videoDetect_Sensitive_title","videoDetect_add_Sensitive","videoDetect_less_Sensitive");f=new FineSlider("videoDetect_Threshold_line","videoDetect_Threshold_icon",{range:[0,100],wheel:!1,onChange:function(c){$("videoDetect_Threshold_line").setProperty("title",c);$("videoDetect_Threshold_title").setProperty("text",c)},onComplete:function(c){h[0].MotionDetectWindow[l].Threshold=
c-0;b._setTempConfig()}},"videoDetect_Threshold_title","videoDetect_add_Threshold","videoDetect_less_Threshold")},_setTempConfig:function(){a!=1&&isEnable("is_has_detectPic")&&(o.push($unlink(h)),o.length==1&&b._setTempConfigOneByOne())},_setTempConfigOneByOne:function(){var c=o.getLast();if(c!=null)c[0].Enable=!0,b.configManager.setTemporaryConfig("MotionDetect",c,function(){o.shift();o=[o.getLast()].clean();b._setTempConfigOneByOne()})},_restoreTempConfig:function(){isEnable("is_has_detectPic")&&
(o=[],b.configManager.restoreTemporaryConfig("MotionDetect",$empty))},_ptzCheckClick:function(){$("videoDetect_ptzCheck0").checked?($("videoDetect_PtzInput0").setStyle("display",""),$("videoDetect_linkSelect0").selectedIndex==0?($("videoDetect_address0").setStyle("display","none"),$("videoDetect_addressInput0").setStyle("display","none")):($("videoDetect_address0").setStyle("display",""),$("videoDetect_addressInput0").setStyle("display",""))):($("videoDetect_PtzInput0").setStyle("display","none"),
$("videoDetect_address0").setStyle("display","none"),$("videoDetect_addressInput0").setStyle("display","none"))},_ptzLinkKeyUp:function(){switch($("videoDetect_linkSelect0").selectedIndex){case 1:b._onLimit_Alarm_Address("videoDetect_addressInput0",e.PresetMin,e.PresetMax);break;case 2:b._onLimit_Alarm_Address("videoDetect_addressInput0",e.TourMin,e.TourMax);break;case 3:b._onLimit_Alarm_Address("videoDetect_addressInput0",e.PatternMin,e.PatternMax)}},_renderAlarmOut:function(c,a){$("videoDetect_alarmOut_"+
a+"_"+c).hasClass("ui-channel-item-current")?$("videoDetect_alarmOut_"+a+"_"+c).removeClass("ui-channel-item-current"):$("videoDetect_alarmOut_"+a+"_"+c).addClass("ui-channel-item-current")},_onDefaultClick:function(){b.configManager.getDefault("MotionDetect",function(c){g=getTable(c);JSON.decode(c).result?(b._renderElements(),remarkDisplay("videoDetect_remark0",tl("Defaultsuccess"),3E3,0)):remarkDisplay("videoDetect_remark0",tl("Defaultfailure"),3E3,1)})},_onRefreshClick:function(){b.configManager.getConfig("MotionDetect",
function(c){g=g=getTable(c);JSON.decode(c).result?(b._renderElements(),remarkDisplay("videoDetect_remark0",tl("Operateingsuccess"),3E3,0)):remarkDisplay("videoDetect_remark0",tl("Operateingfailure"),3E3,1)})},_onConfirmClick:function(){var c=$("videoDetect_confirm0");g=b._saveElements();c.addClass("ui-button-disabled").removeEvent("click",b._onConfirmClick);b.configManager.setConfig("MotionDetect",g,function(a){checkPostResult(a)?(r=$unlink(g),remarkDisplay("videoDetect_remark0",tl("Succeed in saving configure"),
3E3,0),b.configManager.getConfig("MotionDetect",function(a){g=getTable(a);c.removeClass("ui-button-disabled").addEvent("click",b._onConfirmClick)}),SensorInfo!="Normal"&&j(r)):(remarkDisplay("videoDetect_remark0",tl("Saving failure"),3E3,1),c.removeClass("ui-button-disabled").addEvent("click",b._onConfirmClick))})},_saveElements:function(){var c=g[0],a=c.EventHandler;c.Level=$("videoDetect_select_sensitivity").value-0;a.Dejitter=$("videoDetect_antiInput0").value-0;c.Enable=$("videoDetect_able0").checked;
if(n.DetectVersion.contains("V3.0"))c.DetectVersion="V3.0";if(ALARM_FLASH)a.FlashEnable=$("videoDetect_alarmCap").checked,a.FlashLatch=$("videoDetect_flashLanchDelayTime").value-0;a.RecordEnable=$("videoDetect_record0").checked;a.RecordLatch=$("videoDetect_recordDelayInput0").value-0;a.AlarmOutEnable=$("videoDetect_almout0").checked;a.AlarmOutLatch=$("videoDetect_alarmDelayInput0").value-0;a.MailEnable=$("viedoDetect_email0").checked;a.SnapshotEnable=$("videoDetect_snap0").checked;a.PtzLinkEnable=
$("videoDetect_ptzCheck0").checked;a.PtzLink[0]=[d[$("videoDetect_linkSelect0").selectedIndex],$("videoDetect_addressInput0").value-0];a.MMSEnable=$("videoDetect_sendnote0").checked;if(ALARM_OUT_NUMBER>1){for(var c=0,b=[],e=0;e<ALARM_OUT_NUMBER;e++)$("videoDetect_alarmOut_0_"+e).hasClass("ui-channel-item-current")&&(b[c]=e,c+=1);a.AlarmOutChannels=b}else a.AlarmOutChannels=[0];a.RecordChannels=[0];a.SnapshotChannels=[0];a.ExAlarmOutChannels=[0];return g},_onSetupClick:function(){b._drawTimeChart();
b._putTimePeriod(0);b.dialog1.show();$("videoDetect_setTimeTable").style.top="50px"},_drawTimeChart:function(){v=Array.clone(g[0].EventHandler.TimeSection);b.schedule.render(g[0].EventHandler.TimeSection)},_putTimePeriod:function(c){b.schedule._day=c;for(var a=g[0].EventHandler.TimeSection[c],d=0;d<6;d++){var e=parsrTimeEx(a[d]);getBitEx(e[0],0)?$("videoDetect_ts"+d).checked=!0:$("videoDetect_ts"+d).checked=!1;$("videoDetect_t"+d+"0").value=chk10(e[1]);$("videoDetect_t"+d+"1").value=chk10(e[2]);$("videoDetect_t"+
d+"2").value=chk10(e[3]);$("videoDetect_t"+d+"3").value=chk10(e[4]);$("videoDetect_t"+d+"4").value=chk10(e[5]);$("videoDetect_t"+d+"5").value=chk10(e[6])}for(d=0;d<7;d++)$("videoDetect_day"+d).checked=!1,$("videoDetect_day"+d).disabled=!1,$("videoDetect_titleday"+d).removeClass("fn-color-red");$("videoDetect_allweek").checked=!1;$("videoDetect_day"+c).checked=!0;$("videoDetect_day"+c).disabled=!0;$("videoDetect_titleday"+c).addClass("fn-color-red")},_setZoneClick:function(){$("videoDetect_zone").style.left=
"200px";$("video1").setStyles({top:"0px",left:"0px"});b.dialog2.show();if(isEnable("is_has_detectPic"))$("videoDetect_motionFigure_frame").src="/cgi-bin/videomotion.cgi?sessionId="+rpcCore.sessionID;$("videoDetect_zone").style.top="50px";overlayPlugins("videoDetect_detZone");try{$("ocx")&&$("ocx").SetModuleMode(1),$("ocx")&&$("ocx").ConnectRealVideo(0,1),$("ocx")&&$("ocx").SetGridNum(n.MotionRows,n.MotionColumns)}catch(c){}b._showMotionInfo.delay(1)},_showMotionInfo:function(){h=$unlink(g);var c=
[],d=[36597,1171711,16369670,65341],e=h[0].MotionDetectWindow,j=$$(".videodetect-region-item");b._fixMotionDetectData();n.MotionDetectWindow.times(function(a){var b=e[a].Id+"@"+d[a]+"-";b+=e[a].Region.join(":");c.push(b);j[a].set("data-id",e[a].Id);if(k==-1)k=e[a].Id,l=a});try{$("ocx")&&$("ocx").SetFuntionInfo("MotionDetect",c.join(" ")),$("ocx")&&$("ocx").SetCurrentDrawId(k)}catch(m){}a=1;$("videoDetect_region_name").value=h[0].MotionDetectWindow[l].Name;q.set(h[0].MotionDetectWindow[l].Sensitive);
f.set(h[0].MotionDetectWindow[l].Threshold);a=0;b._setTempConfig()},_fixMotionDetectData:function(){var c=h[0].MotionDetectWindow||[],a=[];n.MotionRows.times(function(){a.push(0)});var b=[];n.MotionDetectWindow.times(function(a){b.push(a)});for(c.each(function(a){b.erase(a.Id)});c.length<n.MotionDetectWindow;){var d=b.shift();c.push({Id:d,Name:"Region "+(d+1),Region:a,Sensitive:w,Threshold:x})}h[0].MotionDetectWindow=c},OutPutStringInfo:function(a,d){var e=b._getRegionsData(d),f=h[0].MotionDetectWindow;
e.each(function(a){f.each(function(c){if(c.Id==a.Id)c.Region=a.Region})});b._setTempConfig()},_getRegionsData:function(a){var b=a.split(" ").clean(),d=[];b.each(function(a,c){if(a){var e=b[c].split("-"),f=e[0].split("@")[0]-0,e=e[1].split(":").map(function(a){return a-0});d.push({Id:f,Region:e})}});return d},_clrArea:function(){$("ocx")&&$("ocx").DelSelReg(-2)},_delArea:function(){$("ocx")&&$("ocx").DelSelReg(-1)},_onLinkChange:function(){if($("videoDetect_linkSelect0").selectedIndex==0)$("videoDetect_address0").setStyle("display",
"none"),$("videoDetect_addressInput0").setStyle("display","none");else switch($("videoDetect_address0").setStyle("display",""),$("videoDetect_addressInput0").setStyle("display",""),$("videoDetect_linkSelect0").selectedIndex){case 1:$("videoDetect_addressInput0").value=($("videoDetect_addressInput0").value-0).limit(e.PresetMin,e.PresetMax);break;case 2:$("videoDetect_addressInput0").value=($("videoDetect_addressInput0").value-0).limit(e.TourMin,e.TourMax);break;case 3:$("videoDetect_addressInput0").value=
($("videoDetect_addressInput0").value-0).limit(e.PatternMin,e.PatternMax)}},_saveTimePeriod:function(){for(var a=0,d=g[0].EventHandler.TimeSection,e=[],a=0;a<6;a++)e[a]=$("videoDetect_ts"+a).checked?"1 "+$("videoDetect_t"+a+"0").value+":"+$("videoDetect_t"+a+"1").value+":"+$("videoDetect_t"+a+"2").value+"-"+$("videoDetect_t"+a+"3").value+":"+$("videoDetect_t"+a+"4").value+":"+$("videoDetect_t"+a+"5").value:"0 "+$("videoDetect_t"+a+"0").value+":"+$("videoDetect_t"+a+"1").value+":"+$("videoDetect_t"+
a+"2").value+"-"+$("videoDetect_t"+a+"3").value+":"+$("videoDetect_t"+a+"4").value+":"+$("videoDetect_t"+a+"5").value;for(a=0;a<7;a++)$("videoDetect_day"+a).checked&&(d[a]=e);b.dialog1.obj.style.top="-10000px"},_saveZone:function(){g=$unlink(h);b.dialog2.close()},_onLimit_Alarm_Address:function(a,b,d){if($(a).value!=""){var e=$(a).value;$(a).value=e.replace(/[^\d]/g,"")-0;if(e>d)$(a).value=d-0;if(e<=b)$(a).value=b-0}},_showMotionFigure:function(){var a={id:0,threshold:0},d=showMotionFigure.queue.pop()||
[a];$H(d).each(function(b){b.id==k&&(a=b)});if(k!=p.id)p.clear(),p.id=k;p.threshold=$("videoDetect_Threshold_title").get("text").toInt();p.add(a);p.move();showMotionFigure.queue.length>0&&b._showMotionFigure()},_onFigureOpen:function(){$clear(t);$clear(p.timer);p.timer=setInterval(b._showMotionFigure,170);t=setInterval(function(){(!Site.currentPage.is.videoDetectConfig||!$("videoDetect_motion").hasClass("ui-tab-current"))&&b._onFigureClose()},100)},_onFigureClose:function(){$("videoDetect_motionFigure_frame").src=
"";showMotionFigure.queue=[];$clear(t);p.stop();Site.currentPage.is.videoDetectConfig&&($("b_record")?$("b_record").hasClass("main-top-icon-vedio-current")||$("ocx")&&$("ocx").DisConnectRealVideo(0):$("ocx")&&$("ocx").DisConnectRealVideo(0));b._restoreTempConfig()},logout:function(){t&&b._onFigureClose()}}})();(function(){var j,g,r=["None","Preset","Tour","Pattern"],h=null,q=null,f=Page.videoDetectConfig.Tab.blindDetect={init:function(){f.dialog1=new Dialog("videoDetect_setTimeTable",function(){},
"videoDetect_timeConfirm0","videoDetect_timeCancle0",tl("w_TimeAlarmPeriod"));f.dialog2=new Dialog("videoDetect_zone",function(){},"videoDetect_savezone","videoDetect_close",tl("w_Setting Area"));f.dialog1.setPosition(200,3);f.configManager=new ConfigManager;f.ptzCtrl=new PtzCtrl;f.translate();f.bind()},translate:function(){$("UnFocusDetect_ableTitle").set("text",tl("w_UnFocusDetectEnable"));$("videoDetect_videoInput1").set("text",tl("w_VideoInput"));$("UnFocusDetect_Sen_label").set("text",tl("w_Sensitivity"));
$("videoDetect_workPeriod1").set("text",tl("w_TimeAlarmPeriod"));$("videoDetect_tab_blindDetect").getElements("span[name=t_sec]").each(function(a){a.setProperty("text",tl("w_Second"))});$("videoDetect_recordChannel1").set("text",tl("w_RecordChannel"));$("videoDetect_recordDelay1").set("text",tl("RecordLatch"));$("videoDetect_alarmOut1").set("text",tl("w_Alarm Out"));$("videoDetect_alarmDelay1").set("text",tl("AlarmOutLatch"));$("videoDetect_emailTitle1").set("text",tl("w_Send E-Mail"));$("videoDetect_ptzTitle1").set("text",
tl("w_PtzLink"));$("videoDetect_linkTitle1").set("text",tl("w_LinkWork"));var d=$("videoDetect_linkSelect1").getElements("option");d[0].setProperty("text",tl("w_none"));d[1].setProperty("text",tl("w_Preset"));d[2].setProperty("text",tl("w_Tour"));d[3].setProperty("text",tl("w_Pattern"));$("videoDetect_address1").set("text",tl("w_ptzAddress"));$("videoDetect_snapTitle1").set("text",tl("w_Snap"));$("videoDetect_sendnoteTitle1").set("text",tl("w_noteLink"));$("videoDetect_default1").set("text",tl("w_DefaultConfig"));
$("videoDetect_refresh1").set("text",tl("w_Refresh"));$("videoDetect_confirm1").set("text",tl("w_Confirm"));$("videoDetect_setButton1").set("text",tl("w_Setup"))},render:function(){$("videoDetect_timeConfirm0").removeEvents("click").addEvent("click",f._saveTimePeriod);$$("#page_videoDetectConfig a[id^=videoDetect_tmset]").removeEvents("click").addEvent("click",function(){var d=this.id.replace(/[^\d]/g,"");f._putTimePeriod(d)});f.dialog1.close();f.dialog2.close();f._renderInitPage();f.ptzCtrl.getCurrentProtocolCaps(function(d){if(JSON.decode(d).result&&
JSON.decode(d).params)h=JSON.decode(d).params.caps,$("videoDetect_linkSelect1").innerHTML="",$("videoDetect_linkSelect1").options.add(new Option(tl("w_none"),1)),h.Preset!==!1&&$("videoDetect_linkSelect1").options.add(new Option(tl("w_Preset"),2)),h.Tour!==!1&&$("videoDetect_linkSelect1").options.add(new Option(tl("w_Auto-Tour"),3)),h.Pattern!==!1&&$("videoDetect_linkSelect1").options.add(new Option(tl("w_Pattern"),4))},0,!1);hasPtz==!0&&h&&h.Type?$("videoDetect_ptzLink2").setStyle("display",""):
$("videoDetect_ptzLink2").setStyle("display","none");f.configManager.getConfig(m,function(d,a){if(a.params[0].result)j=a.params[0].params.table;if(a.params[1]&&a.params[1].result)g=a.params[1].params.table;f._renderElements()});$("videoDetect_chartZone").removeEvents();f.schedule=new Schedule("videoDetect_chartZone",{type:"general",onChange:function(){f._putTimePeriod(f.schedule._day)}})},bind:function(){$("videoDetect_default1").addEvent("click",f._onDefaultClick);$("videoDetect_refresh1").addEvent("click",
f._onRefreshClick);$("videoDetect_confirm1").addEvent("click",f._onConfirmClick);$("videoDetect_setButton1").addEvent("click",f._onSetupClick);attachLimit("videoDetect_recordDelayInput1",10,300);attachLimit("videoDetect_alarmDelayInput1",10,300);attachLimit("UnFocusDetect_Sensitivity",1,100);$("videoDetect_addressInput1").addEvents({keyup:function(){f._ptzLinkKeyUp()},blur:function(){if(this.value=="")switch($("videoDetect_linkSelect1").selectedIndex){case 1:this.value=h.PresetMin;break;case 2:this.value=
h.TourMin;break;case 3:this.value=h.PatternMin}else f._ptzLinkKeyUp()}});$("videoDetect_linkSelect1").addEvent("change",f._onLinkChange);$("videoDetect_ptzCheck1").addEvent("click",f._ptzCheckClick);$$("#videoDetect_setTimeTable .ui-dialog-icon, #videoDetect_timeCancle0").addEvent("click",function(){if($("videoDetect_blind")&&$("videoDetect_blind").hasClass("ui-tab-current")&&q)j[0].EventHandler.TimeSection=Array.clone(q),q=null})},_renderInitPage:function(){bool_4g||bool_get4GNet?$("videoDetect_note1").setStyle("display",
""):bool_get3GNet&&bool_3g?$("videoDetect_note1").setStyle("display",""):$("videoDetect_note1").setStyle("display","none");ALARM_OUT_NUMBER==0?$$("#videoDetect_alarmO3,#videoDetect_alarmO4").setStyle("display","none"):$$("#videoDetect_alarmO3,#videoDetect_alarmO4").setStyle("display","");CHANNEL_NUMBER<=1?$("videoDetect_video1").setStyle("display","none"):alert("DVR")},_renderElements:function(){var d=j[0],a=d.EventHandler,e="";if(ALARM_OUT_NUMBER>1){for(var k=0;k<ALARM_OUT_NUMBER;k++)e+='<a href="javascript:;" class="ui-channel-item videoDetect_alarmOut"  id="videoDetect_alarmOut_1_'+
k+'">'+(k+1)+"</a>";$("videoDetect_alarmOutAdd1").innerHTML=e;$$(".videoDetect_alarmOut").addEvent("click",function(){var a=this.id.split("_");f._renderAlarmOut(a[3],a[2])});for(var e=a.AlarmOutChannels.length,k=a.AlarmOutChannels,l=0;l<e;l++)$("videoDetect_alarmOut_1_"+k[l]).addClass("ui-channel-item-current")}$("videoDetect_able1").checked=d.Enable;$("UnFocusDetect_able").checked=g&&g[0].Enable;$("UnFocusDetect_Sensitivity").value=g&&g[0].Sensitivity;if(a.Delay==void 0)a.Delay=0;$("videoDetect_record1").checked=
a.RecordEnable;$("videoDetect_recordDelayInput1").value=a.RecordLatch;$("videoDetect_almout1").checked=a.AlarmOutEnable;$("videoDetect_alarmDelayInput1").value=a.AlarmOutLatch;$("viedoDetect_email1").checked=a.MailEnable;$("videoDetect_snap1").checked=a.SnapshotEnable;$("videoDetect_ptzCheck1").checked=a.PtzLinkEnable;if(a.PtzLink.length==0)a.PtzLink=[["None",1]];d=a.PtzLink[0];e=r.indexOf(d[0]);$("videoDetect_linkSelect1").selectedIndex=e;$("videoDetect_addressInput1").value=d[1];if(h!=null)switch(e){case 1:d[1]>
h.PresetMax?$("videoDetect_addressInput1").value=h.PresetMax:$("videoDetect_addressInput1").value=d[1];break;case 2:d[1]>h.TourMax?$("videoDetect_addressInput1").value=h.TourMax:$("videoDetect_addressInput1").value=d[1];break;case 3:d[1]>h.PatternMax?$("videoDetect_addressInput1").value=h.PatternMax:$("videoDetect_addressInput1").value=d[1]}f._ptzCheckClick();a.MMSEnable?$("videoDetect_sendnote1").checked=a.MMSEnable:$("videoDetect_sendnote1").checked=!1},_renderAlarmOut:function(d,a){$("videoDetect_alarmOut_"+
a+"_"+d).hasClass("ui-channel-item-current")?$("videoDetect_alarmOut_"+a+"_"+d).removeClass("ui-channel-item-current"):$("videoDetect_alarmOut_"+a+"_"+d).addClass("ui-channel-item-current")},_ptzCheckClick:function(){$("videoDetect_ptzCheck1").checked?($("videoDetect_PtzInput1").setStyle("display",""),$("videoDetect_linkSelect1").selectedIndex==0?($("videoDetect_address1").setStyle("display","none"),$("videoDetect_addressInput1").setStyle("display","none")):($("videoDetect_address1").setStyle("display",
""),$("videoDetect_addressInput1").setStyle("display",""))):($("videoDetect_PtzInput1").setStyle("display","none"),$("videoDetect_address1").setStyle("display","none"),$("videoDetect_addressInput1").setStyle("display","none"))},_ptzLinkKeyUp:function(){switch($("videoDetect_linkSelect1").selectedIndex){case 1:f._onLimit_Alarm_Address("videoDetect_addressInput1",h.PresetMin,h.PresetMax);break;case 2:f._onLimit_Alarm_Address("videoDetect_addressInput1",h.TourMin,h.TourMax);break;case 3:f._onLimit_Alarm_Address("videoDetect_addressInput1",
h.PatternMin,h.PatternMax)}},_onDefaultClick:function(){f.configManager.getDefault(m,function(d,a){if(a.result){if(a.params[0].result)j=a.params[0].params.table;if(a.params[1]&&a.params[1].result)g=a.params[1].params.table;f._renderElements();remarkDisplay("videoDetect_remark1",tl("Defaultsuccess"),3E3,0)}else remarkDisplay("videoDetect_remark1",tl("Defaultfailure"),3E3,1)})},_onRefreshClick:function(){f.configManager.getConfig(m,function(d,a){if(a.result){if(a.params[0].result)j=a.params[0].params.table;
if(a.params[1]&&a.params[1].result)g=a.params[1].params.table;f._renderElements();remarkDisplay("videoDetect_remark1",tl("Operateingsuccess"),3E3,0)}else remarkDisplay("videoDetect_remark1",tl("Operateingfailure"),3E3,1)})},_onConfirmClick:function(){j=f._saveElements();var d=[j,g];g?(g[0].EventHandler=j[0].EventHandler,g[0].Enable=$("UnFocusDetect_able").checked,g[0].Sensitivity=$("UnFocusDetect_Sensitivity").value-0):d=[j];f.configManager.setConfig(m,d,function(a){checkPostResult(a)?remarkDisplay("videoDetect_remark1",
tl("Succeed in saving configure"),3E3,0):remarkDisplay("videoDetect_remark1",tl("Saving failure"),3E3,1)})},_saveElements:function(){var d=j[0],a=d.EventHandler;d.Enable=$("videoDetect_able1").checked;a.RecordEnable=$("videoDetect_record1").checked;a.RecordLatch=$("videoDetect_recordDelayInput1").value-0;a.AlarmOutEnable=$("videoDetect_almout1").checked;a.AlarmOutLatch=$("videoDetect_alarmDelayInput1").value-0;a.MailEnable=$("viedoDetect_email1").checked;a.SnapshotEnable=$("videoDetect_snap1").checked;
a.PtzLinkEnable=$("videoDetect_ptzCheck1").checked;a.PtzLink[0]=[r[$("videoDetect_linkSelect1").selectedIndex],$("videoDetect_addressInput1").value-0];a.MMSEnable=$("videoDetect_sendnote1").checked;if(ALARM_OUT_NUMBER>1){for(var d=0,e=[],f=0;f<ALARM_OUT_NUMBER;f++)$("videoDetect_alarmOut_1_"+f).hasClass("ui-channel-item-current")&&(e[d]=f,d+=1);a.AlarmOutChannels=e}else a.AlarmOutChannels=[0];a.RecordChannels=[0];a.SnapshotChannels=[0];a.ExAlarmOutChannels=[0];return j},_onSetupClick:function(){f._drawTimeChart();
f._putTimePeriod(0);f.dialog1.show();$("videoDetect_setTimeTable").style.top="50px"},_drawTimeChart:function(){q=Array.clone(j[0].EventHandler.TimeSection);f.schedule.render(j[0].EventHandler.TimeSection)},_putTimePeriod:function(d){f.schedule._day=d;for(var a=j[0].EventHandler.TimeSection[d],e=0;e<6;e++){var g=parsrTimeEx(a[e]);getBitEx(g[0],0)?$("videoDetect_ts"+e).checked=!0:$("videoDetect_ts"+e).checked=!1;$("videoDetect_t"+e+"0").value=chk10(g[1]);$("videoDetect_t"+e+"1").value=chk10(g[2]);$("videoDetect_t"+
e+"2").value=chk10(g[3]);$("videoDetect_t"+e+"3").value=chk10(g[4]);$("videoDetect_t"+e+"4").value=chk10(g[5]);$("videoDetect_t"+e+"5").value=chk10(g[6])}for(e=0;e<7;e++)$("videoDetect_day"+e).checked=!1,$("videoDetect_day"+e).disabled=!1,$("videoDetect_titleday"+e).removeClass("fn-color-red");$("videoDetect_allweek").checked=!1;$("videoDetect_day"+d).checked=!0;$("videoDetect_day"+d).disabled=!0;$("videoDetect_titleday"+d).addClass("fn-color-red")},_onLinkChange:function(){if($("videoDetect_linkSelect1").selectedIndex==
0)$("videoDetect_address1").setStyle("display","none"),$("videoDetect_addressInput1").setStyle("display","none");else switch($("videoDetect_address1").setStyle("display",""),$("videoDetect_addressInput1").setStyle("display",""),$("videoDetect_linkSelect1").selectedIndex){case 1:$("videoDetect_addressInput1").value=($("videoDetect_addressInput1").value-0).limit(h.PresetMin,h.PresetMax);break;case 2:$("videoDetect_addressInput1").value=($("videoDetect_addressInput1").value-0).limit(h.TourMin,h.TourMax);
break;case 3:$("videoDetect_addressInput1").value=($("videoDetect_addressInput1").value-0).limit(h.PatternMin,h.PatternMax)}},_saveTimePeriod:function(){var d=j[0].EventHandler.TimeSection,a=[];for(i=0;i<6;i++)a[i]=$("videoDetect_ts"+i).checked?"1 "+$("videoDetect_t"+i+"0").value+":"+$("videoDetect_t"+i+"1").value+":"+$("videoDetect_t"+i+"2").value+"-"+$("videoDetect_t"+i+"3").value+":"+$("videoDetect_t"+i+"4").value+":"+$("videoDetect_t"+i+"5").value:"0 "+$("videoDetect_t"+i+"0").value+":"+$("videoDetect_t"+
i+"1").value+":"+$("videoDetect_t"+i+"2").value+"-"+$("videoDetect_t"+i+"3").value+":"+$("videoDetect_t"+i+"4").value+":"+$("videoDetect_t"+i+"5").value;for(i=0;i<7;i++)$("videoDetect_day"+i).checked&&(d[i]=a);f.dialog1.obj.style.top="-10000px"},_onLimit_Alarm_Address:function(d,a,e){if($(d).value!=""){var f=$(d).value;$(d).value=f.replace(/[^\d]/g,"")-0;if(f>e)$(d).value=e-0;if(f<=a)$(d).value=a-0}}}})()})();
function showMotionFigure(m){showMotionFigure.queue.push(m.data);m="0@"+MotionDetectInfoColor+"-"+m.Region.join(":");$("ocx")&&$("ocx").SetFuntionInfo("MotionDetectInfo",m)}showMotionFigure.queue=[];var MotionDetectInfoColor=10066329;
