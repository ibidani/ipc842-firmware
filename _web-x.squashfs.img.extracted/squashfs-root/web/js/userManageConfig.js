(function(){var g,f,k,m,h="",i=-1,d="",j=-1,n,o,p,q,r,s,l=["ComConf","MHardisk","ShutDown"],b=Page.userManageConfig={init:function(){n=new Dialog("user_adduser_dialog",b._onSveAdUsrButton,"user_adduser_confirm","user_adduser_cancel",tl("w_AddUser"));n.setPosition(300,80);o=new Dialog("user_deluser_dialog",b._onDelUserButton,"user_deluser_confirm","user_deluser_cancel",tl("w_DeleteUser"));o.setPosition(400,200);p=new Dialog("user_setuser_dialog",b._onSveModButton,"user_setuser_confirm","user_setuser_cancel",
tl("w_ModifyUser"));p.setPosition(300,80);q=new Dialog("user_addgroup_dialog",b._onSveAdGrpButton,"user_addgroup_confirm","user_addgroup_cancel",tl("w_AddGroup"));q.setPosition(300,80);r=new Dialog("user_setgroup_dialog",b._onSveModGrpButton,"user_setgroup_confirm","user_setgroup_cancel",tl("w_ModifyGroup"));r.setPosition(300,80);s=new Dialog("user_delgroup_dialog",b._onDelGrpButton,"user_delgroup_confirm","user_delgroup_cancel",tl("w_DeleteGroup"));s.setPosition(400,200);b.translate();b.render();
b.bind()},translate:function(){$("user_anonymlogin_label").set("text",tl("w_AnonymousLogin"));$("user").set("text",tl("w_User Management"));$("user_tab_user").set("text",tl("w_User"));$("user_tab_group").set("text",tl("w_User Group"));$("user_tab_user_number").set("text",tl("w_Numbers"));$("user_tab_user_name").set("text",tl("w_User"));$("user_tab_user_memo").set("text",tl("w_Remark"));$("user_tab_user_adduser").set("text",tl("w_AddUser"));$("user_tab_user_groupname").set("text",tl("w_Group Name"));
$("user_tab_user_modify").set("text",tl("w_Amend"));$("user_tab_user_delete").set("text",tl("Delete"));$("user_tab_group_modify").set("text",tl("w_Amend"));$("user_tab_group_delete").set("text",tl("Delete"));$("user_tab_group_number").set("text",tl("w_Numbers"));$("user_tab_group_name").set("text",tl("w_Group Name"));$("user_tab_group_memo").set("text",tl("w_Remark"));$("user_tab_user_addgroup").set("text",tl("w_AddGroup"));$("user_tab_user_authlist_label").set("text",tl("w_AuthList"));$("user_tab_group_authlist_label").set("text",
tl("w_AuthList"));$("user_adduser_name_label").set("text",tl("w_User"));$("user_adduser_password_label").set("text",tl("w_password"));$("user_adduser_passwordconfirm_label").set("text",tl("w_Pwdconfirm"));$("user_adduser_group").set("text",tl("w_User Group"));$("user_adduser_memo_label").set("text",tl("w_Remark"));$("user_adduser_authoritylist_label").set("text",tl("w_AuthList"));$("user_adduser_authoritylist_all").set("text",tl("w_Check All"));$("user_adduser_confirm").set("text",tl("w_Save"));$("user_adduser_cancel").set("text",
tl("Cancel"));$("user_setuser_username_label").set("text",tl("w_User"));$("user_setuser_group_label").set("text",tl("w_User Group"));$("user_setuser_memo_label").set("text",tl("w_Remark"));$("user_setuser_authoritylist_label").set("text",tl("w_AuthList"));$("user_setuser_authoritylist_all").set("text",tl("w_Check All"));$("user_setuser_confirm").set("text",tl("w_Save"));$("user_setuser_cancel").set("text",tl("Cancel"));$("user_setuser_checkpassword_label").set("text",tl("w_ChangePwd"));$("user_setuser_oldpassword_label").set("text",
tl("w_OldPwd"));$("user_setuser_newpassword_label").set("text",tl("w_NewPwd"));$("user_setuser_confirmpassword_label").set("text",tl("w_Pwdconfirm"));$("user_deluser_title").set("text",tl("w_ConfirmUser"));$("user_deluser_confirm").set("text",tl("Ok"));$("user_deluser_cancel").set("text",tl("Cancel"));$("user_delgroup_confirm").set("text",tl("Ok"));$("user_delgroup_cancel").set("text",tl("Cancel"));$("user_delgroup_title").set("text",tl("w_ConfirmGroup"));$("user_addgroup_name_label").set("text",
tl("w_User Group"));$("user_addgroup_memo_label").set("text",tl("w_Remark"));$("user_addgroup_authoritylist_label").set("text",tl("w_AuthList"));$("user_addgroup_authoritylist_all").set("text",tl("w_Check All"));$("user_addgroup_confirm").set("text",tl("w_Save"));$("user_addgroup_cancel").set("text",tl("Cancel"));$("user_setgroup_username_label").set("text",tl("w_User Group"));$("user_setgroup_memo_label").set("text",tl("w_Remark"));$("user_setgroup_authoritylist_label").set("text",tl("w_AuthList"));
$("user_setgroup_authoritylist_all").set("text",tl("w_Check All"));$("user_setgroup_confirm").set("text",tl("w_Save"));$("user_setgroup_cancel").set("text",tl("Cancel"));$("user_help").set("title",tl("w_help"));$$("#user_deluser_dialog h1").set("text",tl("w_DeleteUser"));$$("#user_setuser_dialog h1").set("text",tl("w_ModifyUser"));$$("#user_adduser_dialog h1").set("text",tl("w_AddUser"));$$("#user_delgroup_dialog h1").set("text",tl("w_DeleteGroup"));$$("#user_setgroup_dialog h1").set("text",tl("w_ModifyGroup"));
$$("#user_addgroup_dialog h1").set("text",tl("w_AddGroup"))},render:function(){b._DOCloseSuccess();l=hasSDCard?["ComConf","MHardisk","ShutDown"]:["ComConf","MHardisk","ShutDown","Replay_01","Backup"];$("user_tab_user").hasClass("ui-table-tab-current")||b._onTabClick($("user_tab_user"),"user_tab_user_wrap");var a=$("page_UserConfig"),c=document.createElement("script");c.setAttribute("type","text/javascript");c.setAttribute("src","../jsCore/md5.js");a.appendChild(c);a=new UserManager;a.getAuthorityList(function(a){if(JSON.decode(a).result)k=
JSON.decode(a).params});a.getUserInfo("anonymity",function(a){if(JSON.decode(a).result)m=JSON.decode(a).params.user,$("user_anonymlogin").checked=m.Anonymous});a.getGroupInfoAll(function(a){b._getGroupInfoList(a);b._showGroupAuthority(f[0].Name)});a.getUserInfoAll(function(a){b._getUserInfoList(a);b._showUserAuthority(g[0].Name)})},bind:function(){$("user_tab_user_anonymlogin").addEvent("click",b._onAnonymityLoginEnableClick);$("user_setuser_username").addEvent("change",b._onModifyUserChange);$("user_adduser_group_list").addEvent("change",
b._onAddUserGrpListChange);$("user_setuser_group").addEvent("change",b._onSetUserGroupListChange);$("user_setgroup_username").addEvent("change",b._onModifyGroupChange);$("user_setuser_checkpassword").addEvent("click",b._onCheckPasswordClick);$("user_tab_user_adduser").addEvent("click",function(){b._DOCloseSuccess();n.show();b._clearUserHint();b._addUserDisplay()});$("user_tab_user_addgroup").addEvent("click",function(){b._DOCloseSuccess();b._addGrpDisplay();q.show();b._clearGrpHint();b._fillAuthority("",
k,"user_addgroup_authoritylist_range");checkAll("user_addgroup_authoritylist",$("user_addgroup_authoritylist_range"),"user_addgroup_authoritylist_range")});$("user_adduser_name").addEvent("keyup",function(){promptImportLimt("user_adduser_name","user_adduser_name_tip","w_Badstring",12)});$("user_adduser_password").addEvent("keyup",function(){promptImportLimt("user_adduser_password","user_adduser_password_tip","w_Badpwd",9)});$("user_adduser_passwordconfirm").addEvent("keyup",function(){promptImportLimt("user_adduser_passwordconfirm",
"user_adduser_passwordconfirm_tip","w_Badpwd",9)});$("user_addgroup_name").addEvent("keyup",function(){promptImportLimt("user_addgroup_name","user_addgroup_name_tip","w_Badstring",12)});$("user_setgroup_memo").addEvent("keyup",function(){this.value.length==0?$("user_setgroup_memo_tip").setProperty("text",""):promptImportLimt("user_setgroup_memo","user_setgroup_memo_tip","w_Badmemo",14)});$("user_adduser_memo").addEvent("keyup",function(){this.value.length==0?$("user_adduser_memo_tip").setProperty("text",
""):promptImportLimt("user_adduser_memo","user_adduser_memo_tip","w_Badmemo",14)});$("user_addgroup_memo").addEvent("keyup",function(){this.value.length==0?$("user_addgroup_memo_tip").setProperty("text",""):promptImportLimt("user_addgroup_memo","user_addgroup_memo_tip","w_Badmemo",14)});$("user_setuser_memo").addEvent("keyup",function(){this.value.length==0?$("user_setuser_memo_tip").setProperty("text",""):promptImportLimt("user_setuser_memo","user_setuser_memo_tip","w_Badmemo",14)});$("user_tab_user").addEvent("click",
function(){b._onTabUserClick()});$("user").addEvent("click",function(){b._onTabUserClick()});$("user_tab_group").addEvent("click",function(){b._onTabGroupClick()});$("user_setuser_authoritylist").addEvent("click",function(){checkAll("user_setuser_authoritylist",$("user_setuser_authoritylist"),"user_setuser_authoritylist_range")});$("user_setuser_authoritylist_range").addEvent("click",function(){checkAll("user_setuser_authoritylist",$("user_setuser_authoritylist_range"),"user_setuser_authoritylist_range")});
$("user_adduser_authoritylist").addEvent("click",function(){checkAll("user_adduser_authoritylist",$("user_adduser_authoritylist"),"user_adduser_authoritylist_range")});$("user_adduser_authoritylist_range").addEvent("click",function(){checkAll("user_adduser_authoritylist",$("user_adduser_authoritylist_range"),"user_adduser_authoritylist_range")});$("user_setgroup_authoritylist").addEvent("click",function(){checkAll("user_setgroup_authoritylist",$("user_setgroup_authoritylist"),"user_setgroup_authoritylist_range")});
$("user_setgroup_authoritylist_range").addEvent("click",function(){checkAll("user_setgroup_authoritylist",$("user_setgroup_authoritylist_range"),"user_setgroup_authoritylist_range")});$("user_addgroup_authoritylist").addEvent("click",function(){checkAll("user_addgroup_authoritylist",$("user_addgroup_authoritylist"),"user_addgroup_authoritylist_range")});$("user_addgroup_authoritylist_range").addEvent("click",function(){checkAll("user_addgroup_authoritylist",$("user_addgroup_authoritylist_range"),
"user_addgroup_authoritylist_range")});$("user_help").addEvent("click",function(){openHelp("userManageConfig.htm")})},_onTabClick:function(a,b){$("user_tab_user_wrap").style.display="none";$("user_tab_group_wrap").style.display="none";$(b).style.display="block";$("user_tab_user").className="";$("user_tab_group").className="";a.className="ui-table-tab-current"},_getGroupInfoList:function(a){if(JSON.decode(a).result){f=JSON.decode(a).params;$("user_tab_group_infolist").innerHTML="";for(var a='<table cellpadding="0" cellspacing="0" >',
c=0;c<f.length;c++)a+='<tr id = "groupInfoList_'+c+'" class="user_selectgrp '+(c%2?"":"ui-table-tr-odd")+'">',a+='<td class = "fn-widp10">'+(c+1)+"</td>",a+='<td id="groupNameList_'+c+'" class="fn-widp20">'+f[c].Name+"</td>",a+='<td class="fn-widp50">'+f[c].Memo+"</td>",a+='<td class="fn-widp10"><i id = "user_item_changegroup_'+c+'" class="ui-table-icon-edit user_changegrpInfo"></i></td>',a+='<td><i id = "user_item_delgroup_'+c+'" class="ui-table-icon-del user_delgrp"></i></td>',a+="</tr>";a+="</table>";
$("user_tab_group_infolist").innerHTML=a;$("groupInfoList_0").addClass("ui-table-tr-current");$$("#page_UserConfig .user_selectgrp").addEvent("click",function(){b._onSelectGrp(this.id)});$$("#page_UserConfig .user_changegrpInfo").addEvent("click",function(){var a=this.id.replace(/[^\d]/g,"");b._changeGroupInfo(a)});$$("#page_UserConfig .user_delgrp").addEvent("click",function(){var a=this.id.replace(/[^\d]/g,"");b._delGroup(a)})}},_getUserInfoList:function(a){if(JSON.decode(a).result){g=JSON.decode(a).params.users;
$("user_tab_user_infolist").innerHTML="";for(var a='<table cellpadding="0" cellspacing="0" >',c=0;c<g.length;c++)a+='<tr id = "userInfoList_'+c+'" class="user_selectuser '+(c%2?"":"ui-table-tr-odd")+'">',a+='<td class = "fn-widp10">'+(c+1)+"</td>",a+='<td id="userNameList_'+c+'" class = "fn-widp15">'+g[c].Name+"</td>",a+='<td class="fn-widp15">'+g[c].Group+"</td>",a+='<td class="fn-widp40 fn-text-overflow">'+g[c].Memo+"</td>",a+='<td class="fn-widp10"><i id = "user_item_changeuser_'+c+'" class="ui-table-icon-edit user_changeUserInfo"></i></td>',
a+='<td><i id = "user_item_deluser_'+c+'" class="ui-table-icon-del user_delUser"></i></td>',a+="</tr>";a+="</table>";$("user_tab_user_infolist").innerHTML=a;$("userInfoList_0").addClass("ui-table-tr-current");$$("#page_UserConfig .user_selectuser").addEvent("click",function(){b._onSelectUser(this.id)});$$("#page_UserConfig .user_changeUserInfo").addEvent("click",function(){var a=this.id.replace(/[^\d]/g,"");b._changeUserInfo(a)});$$("#page_UserConfig .user_delUser").addEvent("click",function(){var a=
this.id.replace(/[^\d]/g,"");b._delUser(a)})}},_showUserAuthority:function(a){(new UserManager).getUserInfo(a,b._showUserAuthList)},_showUserAuthList:function(a){if(JSON.decode(a).result){for(var a=JSON.decode(a).params.user.AuthorityList,b=$("user_tab_user_authlist").innerHTML="",e=0;e<a.length;e++)l.contains(a[e])||(b+='<span class="ui-detail-item">'+tl(a[e])+"</span>");$("user_tab_user_authlist").innerHTML=b}},_showGroupAuthority:function(a){(new UserManager).getGroupInfo(a,b._showGroupAuthList)},
_showGroupAuthList:function(a){if(JSON.decode(a).result){for(var a=JSON.decode(a).params.group.AuthorityList,b=$("user_tab_group_authlist").innerHTML="",e=0;e<a.length;e++)l.contains(a[e])||(b+='<span class="ui-detail-item">'+tl(a[e])+"</span>");$("user_tab_group_authlist").innerHTML=b}},_onModifyUserChange:function(){var a=getSelect("user_setuser_username"),c=$unlink(b._getSelectUserInfo(a));$("user_setuser_memo_tip").setProperty("text","");$("user_setuser_memo").value=c.Memo;h=c.Group;b._changeUserGroup();
var e=$unlink(b._getGrpInfo(c.Group));b._fillAuthority(c.AuthorityList,e.AuthorityList,"user_setuser_authoritylist_range");checkAll("user_setuser_authoritylist",$("user_setuser_authoritylist_range"),"user_setuser_authoritylist_range");b._chkMyself(a)},_changeUserGroup:function(){$("user_setuser_group").empty();for(var a=0;a<f.length;a++)if($("user_setuser_group").options.add(new Option),$("user_setuser_group").options[a].value=a,$("user_setuser_group").options[a].text=f[a].Name,$("user_setuser_group").options[a].text==
h&&h!="")$("user_setuser_group").options[a].selected="true";b._onSetUserGroupListChange()},_onSetUserGroupListChange:function(){var a=getSelect("user_setuser_group"),c=$unlink(b._getGrpInfo(a)),e=$unlink(b._getSelectUserInfo(d));a!=h?b._fillAuthority(" ",c.AuthorityList,"user_setuser_authoritylist_range"):b._fillAuthority(e.AuthorityList,c.AuthorityList,"user_setuser_authoritylist_range");checkAll("user_setuser_authoritylist",$("user_setuser_authoritylist_range"),"user_setuser_authoritylist_range");
$("user_setuser_authoritylist").disabled==!0?$$("#user_setuser_authoritylist_range input[id^=user_setuser_authoritylist_range_]").setProperty("disabled",!0):$$("#user_setuser_authoritylist_range input[id^=user_setuser_authoritylist_range_]").setProperty("disabled",!1)},_fillAuthority:function(a,b,e){var t="",f=$(e);f.innerHTML="";for(var d=0;d<b.length;d++)if(!l.contains(b[d])){for(var g=0;g<a.length;g++)if(b[d]==a[g])break;t+=g==a.length?'<div class="ui-textarea-item fn-clear"><div class="ui-checkbox"><input type="checkbox" id="'+
e+"_"+d+'"/></div><label class="ui-label-sub" for="'+e+"_"+d+'">'+tl(b[d])+"</label></div>":'<div class="ui-textarea-item fn-clear"><div class="ui-checkbox"><input type="checkbox" checked id="'+e+"_"+d+'"/></div><label class="ui-label-sub" for="'+e+"_"+d+'">'+tl(b[d])+"</label></div>"}f.innerHTML=t},_onAddUserGrpListChange:function(){var a=getSelect("user_adduser_group_list"),a=$unlink(b._getGrpInfo(a));b._fillAuthority(a.AuthorityList,a.AuthorityList,"user_adduser_authoritylist_range");checkAll("user_adduser_authoritylist",
$("user_setuser_authoritylist_range"),"user_adduser_authoritylist_range")},_onModifyGroupChange:function(){var a=getSelect("user_setgroup_username"),a=$unlink(b._getGrpInfo(a));$("user_setgroup_memo_tip").setProperty("text","");$("user_setgroup_memo").value=a.Memo;b._fillAuthority(a.AuthorityList,k,"user_setgroup_authoritylist_range");checkAll("user_setgroup_authoritylist",$("user_setgroup_authoritylist_range"),"user_setgroup_authoritylist_range")},_onCheckPasswordClick:function(){$("user_setuser_checkpassword").checked?
($("user_setuser_oldpassword_wrap").style.display="block",$("user_setuser_newpassword_wrap").style.display="block",$("user_setuser_confirmpassword_wrap").style.display="block"):($("user_setuser_oldpassword_wrap").style.display="none",$("user_setuser_newpassword_wrap").style.display="none",$("user_setuser_confirmpassword_wrap").style.display="none")},_DOCloseSuccess:function(){n.close();o.close();p.close();q.close();r.close();s.close()},_clearUserHint:function(){$$("#user_adduser_name_tip, #user_adduser_password_tip, #user_adduser_passwordconfirm_tip, #user_adduser_memo_tip, #user_adduser_authoritylist_tip").setProperty("text",
tl(""));$$("#user_setuser_memo_tip, #user_setuser_authoritylist_tip, #user_setuser_oldpassword_tip, #user_setuser_newpassword_tip, #user_setuser_confirmpassword_tip").setProperty("text",tl(""))},_clearGrpHint:function(){$$("#user_addgroup_name, #user_addgroup_memo, #user_addgroup_name_tip, #user_addgroup_memo_tip").setProperty("text",tl(""));$$("#user_addgroup_authoritylist_tip, #user_setgroup_memo_tip, #user_setgroup_authoritylist_tip").setProperty("text",tl(""))},_addUserDisplay:function(){$("user_adduser_name").value=
"";$("user_adduser_password").value="";$("user_adduser_passwordconfirm").value="";$("user_adduser_memo").value="";$("user_adduser_authoritylist").checked=!0;$("user_adduser_group_list").empty();for(var a=0;a<f.length;a++)$("user_adduser_group_list").options.add(new Option),$("user_adduser_group_list").options[a].value=a,$("user_adduser_group_list").options[a].text=f[a].Name;b._onAddUserGrpListChange()},_addGrpDisplay:function(){$("user_addgroup_name").value="";$("user_addgroup_memo").value=""},_onSveAdUsrButton:function(){$$("#user_adduser_name_tip, #user_adduser_passwordconfirm_tip, #user_adduser_memo_tip, #user_adduser_authoritylist_tip").setProperty("text",
tl(""));if(checkedImportLimt("user_adduser_name",8))if($("user_adduser_password").value!=$("user_adduser_passwordconfirm").value)$("user_adduser_passwordconfirm_tip").setProperty("text",tl("w_PwdDif"));else if(checkedImportLimt("user_adduser_password",9))if(checkedImportLimt("user_adduser_passwordconfirm",9)){if($("user_adduser_memo").value.length==0)$("user_adduser_memo_tip").setProperty("text","");else if(!checkedImportLimt("user_adduser_memo",14)){$("user_adduser_memo_tip").setProperty("text",
tl("w_Badmemo"));return}var a="Login to ";(new MagicBox).getSerialNo(function(b){JSON.decode(b).result?a+=JSON.decode(b).params.sn:remarkDisplay("user_tab_user_remark",tl("w_Badresult"),3E3,1)},!1);var c={};c.Id=g.length+1;if(c.Id>19)remarkDisplay("user_tab_user_remark",tl("w_maxUsers_19"),3E3,1),b._DOCloseSuccess();else if(c.Name=$("user_adduser_name").value,c.Password=hex_md5(c.Name+":"+a+":"+$("user_adduser_password").value),c.Type="",c.ModifiedTime="",b._isHintFormat("user_adduser_memo")){c.Memo=
$("user_adduser_memo").value;c.Group=getSelect("user_adduser_group_list");var e=$unlink(b._getGrpInfo(c.Group)),d=b._getGrpSeList("user_adduser_authoritylist_range",e.AuthorityList);d.length==0?$("user_adduser_authoritylist_tip").setProperty("text",tl("w_Authnone")):(e.AuthorityList.contains("MHardisk")&&e.AuthorityList.contains("ShutDown")&&d.push("MHardisk","ShutDown"),c.AuthorityList=d,c.Reserved=!1,c.Sharable=!0,(new UserManager).addUser(c,b._addUserResult,!1))}else remarkDisplay("user_tab_user_remark",
tl("w_Memolong"),3E3,1),b._DOCloseSuccess()}else $("user_adduser_passwordconfirm_tip").setProperty("text",tl("w_Badpwd"));else $("user_adduser_password_tip").setProperty("text",tl("w_Badpwd"));else $("user_adduser_name").value.length==0?$("user_adduser_name_tip").setProperty("text",tl("w_Need")):$("user_adduser_name_tip").setProperty("text",tl("w_Badstring"))},_addUserResult:function(a){JSON.decode(a).result?((new UserManager).getUserInfoAll(b._getUserInfoList,!1),b._DOCloseSuccess(),remarkDisplay("user_tab_user_remark",
tl("w_AddUserSuc"),3E3,0)):(b._DOCloseSuccess(),b._chkErrorRemark(a,"user_tab_user_remark","w_AddUserFail",0))},_isHintFormat:function(a){return $(a).value.lens()>30?!1:!0},_onDelUserButton:function(){d==""?(b._DOCloseSuccess(),remarkDisplay("user_tab_user_remark",tl("w_NoUser"),3E3,1)):d=="default"?(b._DOCloseSuccess(),remarkDisplay("user_tab_user_remark",tl("w_DelUserFail"),3E3,1)):(new UserManager).deleteUser(d,b._delUserResult,!1)},_delUserResult:function(a){JSON.decode(a).result?(a=new UserManager,
d="",j=-1,a.getUserInfoAll(b._getUserInfoList,!1),d=$("userNameList_0").getProperty("text"),b._showUserAuthority(d),b._DOCloseSuccess(),remarkDisplay("user_tab_user_remark",tl("w_DelUserSucce"),3E3,0)):(b._DOCloseSuccess(),b._chkErrorRemark(a,"user_tab_user_remark","w_DelUserFail",0))},_onSveModButton:function(){if($("user_setuser_memo").value.length==0)$("user_setuser_memo_tip").setProperty("text","");else if(!checkedImportLimt("user_setuser_memo",14)){$("user_setuser_memo_tip").setProperty("text",
tl("w_Badmemo"));return}b._onSveChangeUserButton()},_onSveModPwdButton:function(){$$("#user_setuser_confirmpassword_tip, #user_setuser_oldpassword_tip").setProperty("text",tl(""));if($("user_setuser_newpassword").value!=$("user_setuser_confirmpassword").value)$("user_setuser_confirmpassword_tip").setProperty("text",tl("w_PwdDif"));else{var a=getSelect("user_setuser_username"),c="Login to ";(new MagicBox).getSerialNo(function(a){JSON.decode(a).result?c+=JSON.decode(a).params.sn:remarkDisplay("user_tab_user_remark",
tl("w_Badresult"),3E3,1)},!1);pwdNew=hex_md5(a+":"+c+":"+$("user_setuser_newpassword").value);pwdOld=hex_md5(a+":"+c+":"+$("user_setuser_oldpassword").value);pwdOld+=$("user_setuser_oldpassword").value;(new UserManager).modifyPassword(a,pwdNew,pwdOld,b._changePwdResult,!1)}},_changePwdResult:function(a){JSON.decode(a).result?(a=Base64.decode(base_pwd).split(":")[0],(d==a||d=="admin")&&b._DOCloseSuccess(),remarkDisplay("user_tab_user_remark",tl("w_ChangeUserSucce"),3E3,0)):(b._DOCloseSuccess(),b._chkErrorRemark(a,
"user_tab_user_remark","w_ChangePwdFail",0))},_chkErrorRemark:function(a,b,e,d){switch(JSON.decode(a).error.code){case 604:remarkDisplay(b,tl("w_useMannageErr_InputNotValid"),3E3,1);break;case 605:d==0?remarkDisplay(b,tl("w_useMannageErr_IndexOverlap_user"),3E3,1):remarkDisplay(b,tl("w_useMannageErr_IndexOverlap_group"),3E3,1);break;case 606:case 607:d==0?remarkDisplay(b,tl("w_useMannageErr_ObjectNotValid_user"),3E3,1):remarkDisplay(b,tl("w_useMannageErr_ObjectNotValid_group"),3E3,1);break;case 608:d==
0?remarkDisplay(b,tl("w_useMannageErr_ObjectInUse_user"),3E3,1):remarkDisplay(b,tl("w_useMannageErr_ObjectInUse_group"),3E3,1);break;case 609:d==0?remarkDisplay(b,tl("w_useMannageErr_SubsetOverlap_user"),3E3,1):remarkDisplay(b,tl("w_useMannageErr_SubsetOverlap_group"),3E3,1);break;case 610:remarkDisplay(b,tl("w_useMannageErr_SaveCfgError"),3E3,1);break;case 611:remarkDisplay(b,tl("w_useMannageErr_PwdNotValid"),3E3,1);break;case 612:remarkDisplay(b,tl("w_useMannageErr_PwdNotMatch"),3E3,1);break;case 613:remarkDisplay(b,
tl("w_useMannageErr_ReservedAccount"),3E3,1);break;case 614:remarkDisplay(b,tl("w_useMannageErr_TooManyGroup"),3E3,1);break;case 615:remarkDisplay(b,tl("w_useMannageErr_TooManyUser"),3E3,1);break;default:remarkDisplay(b,tl(e),3E3,1)}},_onSveChangeUserButton:function(){var a;a=getSelect("user_setuser_username");if(a==username_current)$("user_setuser_checkpassword").checked&&b._onSveModPwdButton();else{var c=$unlink(b._getSelectUserInfo(a));c.Group=getSelect("user_setuser_group");var e=$unlink(b._getGrpInfo(c.Group)),
d=b._getGrpSeList("user_setuser_authoritylist_range",e.AuthorityList);d.length==0?$("user_setuser_authoritylist_tip").setProperty("text",tl("w_Authnone")):($("user_setuser_authoritylist_tip").setProperty("text",""),b._isHintFormat("user_setuser_memo")?(c.Memo=$("user_setuser_memo").value,e.AuthorityList.contains("MHardisk")&&e.AuthorityList.contains("ShutDown")&&d.push("MHardisk","ShutDown"),c.AuthorityList=d,(new UserManager).modifyUser(a,c,b._changeUserResult,!1)):(remarkDisplay("user_tab_user_remark",
tl("w_hintTooLong"),3E3,1),b._DOCloseSuccess()))}},_changeUserResult:function(a){JSON.decode(a).result?((new UserManager).getUserInfoAll(b._getUserInfoList,!1),b._clearUserHint(),$("user_tab_user_wrap").style.display="block",$("user_tab_group_wrap").style.display="none",$("user_tab_user").className="ui-table-tab-current",$("user_tab_group").className="none",$("userInfoList_0").className="ui-table-tr-odd",$("userInfoList_"+j).className="ui-table-tr-current",b._showUserAuthority(d),b._DOCloseSuccess(),
$("user_setuser_checkpassword").checked?b._onSveModPwdButton():remarkDisplay("user_tab_user_remark",tl("w_ChangeUserSucce"),3E3,0)):(b._DOCloseSuccess(),b._chkErrorRemark(a,"user_tab_user_remark","w_ChangeUserFail",0))},_onSveAdGrpButton:function(){$$("#user_addgroup_name_tip, #user_addgroup_authoritylist_tip").setProperty("text",tl(""));if(checkedImportLimt("user_addgroup_name",8)){var a=b._getGrpSeList("user_addgroup_authoritylist_range",k);if(a.length==0)$("user_addgroup_authoritylist_tip").setProperty("text",
tl("w_Authnone"));else{if($("user_addgroup_memo").value.length==0)$("user_addgroup_memo_tip").setProperty("text","");else if(!checkedImportLimt("user_addgroup_memo",14)){$("user_addgroup_memo_tip").setProperty("text",tl("w_Badmemo"));return}var c={};c.Id=f.length+1;c.Id>8?(remarkDisplay("user_tab_group_remark",tl("w_maxGroups_8"),3E3,1),b._DOCloseSuccess()):(c.Name=$("user_addgroup_name").value,b._isHintFormat("user_addgroup_memo")?(c.Memo=$("user_addgroup_memo").value,a.combine(l),c.AuthorityList=
a,a=new UserManager,a.addGroup(c,b._addGrpResult,!1),a.getGroupInfoAll(b._getGroupInfoList,!1)):(remarkDisplay("user_tab_group_remark",tl("w_hintTooLong"),3E3,1),b._DOCloseSuccess()))}}else $("user_addgroup_name").value.length==0?$("user_addgroup_name_tip").setProperty("text",tl("w_Need")):$("user_addgroup_name_tip").setProperty("text",tl("w_Badstring"))},_addGrpResult:function(a){JSON.decode(a).result?(b._onTabGroupClick(),b._DOCloseSuccess(),remarkDisplay("user_tab_group_remark",tl("w_AddGroupSucce"),
3E3,0)):(b._DOCloseSuccess(),b._chkErrorRemark(a,"user_tab_group_remark","w_AddGroupFail",1))},_onTabGroupClick:function(){b._DOCloseSuccess();b._backGrpMode();h="";i=-1;b._clearGrpHint();$("user_tab_user_wrap").style.display="none";$("user_tab_group_wrap").style.display="block";$("user_tab_user").className="none";$("user_tab_group").className="ui-table-tab-current";$("groupInfoList_0").addClass("ui-table-tr-current");b._showGroupAuthority(f[0].Name)},_backGrpMode:function(){var a="groupInfoList_";
if(i!=-1)a+=i,$(a).className=i%2?"none":"ui-table-tr-odd"},_onSveModGrpButton:function(){var a=b._getGrpSeList("user_setgroup_authoritylist_range",k);if(a.length==0)$("user_setgroup_authoritylist_tip").setProperty("text",tl("w_Authnone"));else{$("user_setgroup_authoritylist_tip").setProperty("text","");if($("user_setgroup_memo").value.length==0)$("user_setgroup_memo_tip").setProperty("text","");else if(!checkedImportLimt("user_setgroup_memo",14)){$("user_setgroup_memo_tip").setProperty("text",tl("w_Badmemo"));
return}var c={};c.Name=getSelect("user_setgroup_username");b._isHintFormat("user_setgroup_memo")?(c.Memo=$("user_setgroup_memo").value,a.combine(l),c.AuthorityList=a,(new UserManager).modifyGroup(c.Name,c,b._changeGrpResult,!1)):(remarkDisplay("user_tab_group_remark",tl("w_hintTooLong"),3E3,1),b._DOCloseSuccess())}},_changeGrpResult:function(a){JSON.decode(a).result?((new UserManager).getGroupInfoAll(b._getGroupInfoList,!1),b._clearGrpHint(),$("user_tab_user_wrap").style.display="none",$("user_tab_group_wrap").style.display=
"block",$("user_tab_user").className="none",$("user_tab_group").className="ui-table-tab-current",$("groupInfoList_0").className="ui-table-tr-odd",$("groupInfoList_"+i).className="ui-table-tr-current",b._showGroupAuthority(h),b._DOCloseSuccess(),remarkDisplay("user_tab_group_remark",tl("w_ChangeGrpSuc"),3E3,0)):(b._DOCloseSuccess(),b._chkErrorRemark(a,"user_tab_group_remark","w_ChangeGrpFail",1))},_onDelGrpButton:function(){if(h=="")b._DOCloseSuccess(),remarkDisplay("user_tab_group_remark",tl("w_NoGroup"),
3E3,1);else{var a=new UserManager;a.deleteGroup(h,b._delGroupResult,!1);a.getGroupInfoAll(b._getGroupInfoList,!1)}},_delGroupResult:function(a){JSON.decode(a).result?(h="",i=-1,b._onTabGroupClick(),b._DOCloseSuccess(),remarkDisplay("user_tab_group_remark",tl("w_DelGroupSucce"),3E3,0)):(b._DOCloseSuccess(),b._chkErrorRemark(a,"user_tab_group_remark","w_DelGroupFali",1))},_changeUserInfo:function(a){$("user_setuser_checkpassword").checked=!1;b._onSelectUser("userInfoList_"+a);b._DOCloseSuccess();p.show();
b._clearUserHint();b._changeUserDispay();b._changePwdDispay();b._changeUserGroup();$("user_setuser_oldpassword_wrap").style.display="none";$("user_setuser_newpassword_wrap").style.display="none";$("user_setuser_confirmpassword_wrap").style.display="none";b._chkMyself(d)},_onSelectUser:function(a){b._backUserMode();var c=a.replace(/[^\d]/g,""),e="userNameList_";e+=c;j=c;d=$(e).getProperty("text");$("userInfoList_0").className="ui-table-tr-odd";$(a).addClass("ui-table-tr-current");b._showUserAuthority(d)},
_backUserMode:function(){var a="userInfoList_";if(j!=-1)a+=j,$(a).className=j%2?"none":"ui-table-tr-odd"},_changeUserDispay:function(){$("user_setuser_username").innerHTML="";for(var a=0;a<g.length;a++)if($("user_setuser_username").options.add(new Option),$("user_setuser_username").options[a].value=a,$("user_setuser_username").options[a].text=g[a].Name,$("user_setuser_username").options[a].text==d&&d!="")$("user_setuser_username").options[a].selected="true";b._onModifyUserChange()},_changePwdDispay:function(){$("user_setuser_oldpassword").value=
"";$("user_setuser_newpassword").value="";$("user_setuser_confirmpassword").value=""},_chkMyself:function(a){if(a==username_current||a=="admin"){$("user_setuser_group").disabled=!0;$("user_setuser_memo").disabled=!0;$("user_setuser_authoritylist").disabled=!0;for(a=0;a<k.length;a++)if($("user_setuser_authoritylist_range_"+a))$("user_setuser_authoritylist_range_"+a).disabled=!0}else $("user_setuser_group").disabled=!1,$("user_setuser_memo").disabled=!1,$("user_setuser_authoritylist").disabled=!1},
_changeGroupInfo:function(a){b._onSelectGrp("groupInfoList_"+a);$("user_tab_group_infolist").getElementsByTagName("span").className="";b._DOCloseSuccess();r.show();b._clearGrpHint();$("user_setgroup_username").innerHTML="";for(a=0;a<f.length;a++)if($("user_setgroup_username").options.add(new Option),$("user_setgroup_username").options[a].value=a,$("user_setgroup_username").options[a].text=f[a].Name,$("user_setgroup_username").options[a].text==h&&h!="")$("user_setgroup_username").options[a].selected=
!0;b._onModifyGroupChange()},_onSelectGrp:function(a){b._backGrpMode();var c=a.replace(/[^\d]/g,""),d="groupNameList_";d+=c;i=c;h=$(d).getProperty("text");$("groupInfoList_0").className="ui-table-tr-odd";$(a).addClass("ui-table-tr-current");b._showGroupAuthority(h)},_delUser:function(a){b._onSelectUser("userInfoList_"+a);b._DOCloseSuccess();o.show();b._clearUserHint();b._changeUserDispay()},_delGroup:function(a){b._onSelectGrp("groupInfoList_"+a);b._DOCloseSuccess();s.show()},_getGrpSeList:function(a,
b){for(var d=[],f=0;f<b.length;f++)$(a+"_"+f)!=null&&$(a+"_"+f).checked&&d.include(b[f]);return d},_getSelectUserInfo:function(a){for(var b=0;b<g.length;b++)if(g[b].Name==a)return g[b]},_getGrpInfo:function(a){for(var b=0;b<f.length;b++)if(f[b].Name==a)return f[b]},_onTabUserClick:function(){b._DOCloseSuccess();b._backUserMode();d="";j=-1;b._clearUserHint();$("user_tab_group_wrap").style.display="none";$("user_tab_user_wrap").style.display="block";$("user_tab_user").className="ui-table-tab-current";
$("user_tab_group").className="none";$("userInfoList_0").addClass("ui-table-tr-current");b._showUserAuthority(g[0].Name)},_onAnonymityLoginEnableClick:function(){isAnonymous=$("user_anonymlogin").checked?!0:!1;m.Anonymous=$("user_anonymlogin").checked?!0:!1;(new UserManager).modifyUser("anonymity",m,function(a){var b=$("user_tab_group_wrap").style.display=="none"?"user_tab_user_remark":"user_tab_group_remark";JSON.decode(a).result?(a=$("user_anonymlogin").checked?"w_openAnonymLoginSucceed":"w_closeAnonymLoginSucceed",
remarkDisplay(b,tl(a),3E3,0)):(a=$("user_anonymlogin").checked?"w_openAnonymLoginFailed":"w_closeAnonymLoginFailed",$("user_anonymlogin").checked=!$("user_anonymlogin").checked,remarkDisplay(b,tl(a),3E3,1))},!1)}}})();String.prototype.lens=function(){return this.replace(/[^\x00-\xff]/g,"xxx").length};
