(function(){var e,d,c,f,b=Page.recordCtrlConfig={init:function(){b.magicBox=new MagicBox;b.configManager=new ConfigManager;b.translate();b.render();b.bind()},translate:function(){$("rc_help").set("title",tl("w_help"));$("record_control").set("text",tl("w_Recording Control"));$("rc_packet_length_label").set("text",tl("w_Record Length"));$("rc_packet_length_unit").set("text",tl("w_Minute"));$("rc_pre_record_label").set("text",tl("w_PreRecord"));$("rc_pre_record_unit").set("text",tl("w_Second"));$("rc_mode_label").set("text",
tl("w_Record Mode"));$("rc_mode_auto_label").set("text",tl("w_Automatic"));$("rc_mode_manual_label").set("text",tl("w_Manual"));$("rc_mode_off_label").set("text",tl("w_close"));$("rc_default").set("text",tl("w_DefaultConfig"));$("rc_refresh").set("text",tl("w_Refresh"));$("rc_confirm").set("text",tl("w_Confirm"));$("rc_disk_full_label").set("text",tl("w_diskfull"));$("rc_disk_full_overwrite").set("text",tl("w_overwrite"));$("rc_disk_full_stop").set("text",tl("Stop"));$("rc_stream_label").set("text",
tl("w_RecordStream"))},render:function(){b._buildStreamOptions();b._checkExtraStream();b.magicBox.getProductDef("MaxPreRecordTime",function(a){a=JSON.decode(a);a=a.result?a.params.definition:5;$("rc_pre_record_tip").set("text","(0~"+a+")");attachLimit("rc_pre_record",0,a)});b.configManager.getConfig(["MediaGlobal","Record","RecordMode","StorageGroup"],function(a,g){g.result&&(b._getData(g.params),b._renderElements(e,d[0],c[0],f[0]))})},bind:function(){$("rc_default").addEvent("click",b._onDefaultClick);
$("rc_refresh").addEvent("click",b._onRefreshClick);$("rc_confirm").addEvent("click",b._onConfirmClick);$("rc_help").addEvent("click",function(){openHelp("recordCtrlConfig.htm")});attachLimit("rc_packet_length",1,120);$("rc_stream").addEvent("change",function(){this.value!=0?$("rc_pre_record_wrap").setStyle("display","none"):$("rc_pre_record_wrap").setStyle("display","block")})},_getData:function(a){e=a[0].params.table;d=a[1].params.table;c=a[2].params.table;f=a[3].params.table},_renderElements:function(a,
b,c,d){$("rc_packet_length").value=a.PacketLength;$("rc_pre_record").value=b.PreRecord;$("rc_stream").value=b.Stream;$("rc_disk_full").value=d.OverWrite?"overwrite":"stop";$("rc_mode_"+c.Mode).checked=!0;$("rc_stream").fireEvent("change")},_buildStreamOptions:function(){$("rc_stream").empty();$("rc_stream").options.add(new Option(tl("w_MainStream"),0));if(ExtraStreamNum==1)$("rc_stream").options.add(new Option(tl("w_SecondStream0"),1));else for(var a=0;a<ExtraStreamNum;a++)$("rc_stream").options.add(new Option(tl("w_SecondStream"+
(a+1)),a+1))},_onDefaultClick:function(){b.configManager.getDefault(["MediaGlobal","Record","RecordMode","StorageGroup"],function(a){a=JSON.decode(a);a.result?(b._renderElements(a.params[0].params.table,a.params[1].params.table[0],a.params[2].params.table[0],a.params[3].params.table[0]),remarkDisplay("rc_remark",tl("Defaultsuccess"),3E3,0)):remarkDisplay("rc_remark",tl("Defaultfailure"),3E3,1)})},_onRefreshClick:function(){b.configManager.getConfig(["MediaGlobal","Record","RecordMode","StorageGroup"],
function(a){a=JSON.decode(a);a.result?(b._getData(a.params),b._renderElements(e,d[0],c[0],f[0]),remarkDisplay("rc_remark",tl("Operateingsuccess"),3E3,0)):remarkDisplay("rc_remark",tl("Operateingfailure"),3E3,1)})},_onConfirmClick:function(){e.PacketLength=$("rc_packet_length").value-0;d[0].PreRecord=$("rc_pre_record").value-0;d[0].Stream=$("rc_stream").value-0;f[0].OverWrite=$("rc_disk_full").value==="overwrite"?!0:!1;if($("rc_mode_0").checked)c[0].Mode=0;if($("rc_mode_1").checked)c[0].Mode=1;if($("rc_mode_2").checked)c[0].Mode=
2;b.configManager.setConfig(["MediaGlobal","Record","RecordMode","StorageGroup"],[e,d,c,f],function(a){JSON.decode(a).result?remarkDisplay("rc_remark",tl("Succeed in saving configure"),3E3,0):remarkDisplay("rc_remark",tl("Saving failure"),3E3,1)})},_checkExtraStream:function(){b.configManager.getConfig("Encode",function(a){if(JSON.decode(a).result)for(var a=JSON.decode(a).params.table[0].ExtraFormat,b=ExtraStreamNum-1;b>=0;b--)a[b].Video.FPS||$("rc_stream").options.remove(b+1)})}}})();
