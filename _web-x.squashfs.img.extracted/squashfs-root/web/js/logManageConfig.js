(function(){(function(){var d=Page.logManageConfig={Tab:[],init:function(){d._isShowSyslog();d.Tab.logmanage.init();d.Tab.syslog.init();d.translate();d.bind();d.render()},translate:function(){$("logManage_system_log_label").set("text",tl("w_Log"));$("telelogManage_log_label").set("text",tl("w_RemoteLog"));$("logManage_help").set("title",tl("w_help"))},bind:function(){$$(".logmange_tab_title").addEvent("click",d._onTabTitleClick);$("logManage_help").addEvent("click",function(){openHelp("logManageConfig.htm")})},
render:function(){$$(".logmange_tab_title.ui-tab-current").fireEvent("click")},_isShowSyslog:function(){if(isEnable("is_show_Syslog"))$("telelogManage_log_label").style.display=""},_onTabTitleClick:function(){var e=this.getProperty("data-for");$$(".logmange_tab_title").removeClass("ui-tab-current");this.addClass("ui-tab-current");d.Tab[e].render();e=="logmanage"?($("logManage_teleLog_log").style.display="none",$("logManage_delete_log").style.display="",$("logManage_logTab").style.display=""):($("logManage_delete_log").style.display=
"none",$("logManage_logTab").style.display="none",$("logManage_teleLog_log").style.display="")}}})();(function(){function d(b){if(Site.currentPage.is.logManageConfig&&($("logManage_search").setProperty("text",tl("w_Search")),JSON.decode(b).result))$("logManage_search").setProperty("text",tl("w_Search")),$("logManage_search_result_time_label").style.display="block",m=!1}function e(b){$("logManage_log_info_list").innerHTML="";for(var c='<table cellpadding="0" cellspacing="0" >',a=(b-1)*j;a<f.length&&
a<b*j;a++)c+=a%2!=0?'<tr id="logInfoList_'+a+'" >':'<tr id="logInfoList_'+a+'" class="ui-table-tr-odd">',c+='<td class="fn-widp15">'+(a+1)+"</td>",c+='<td class="fn-widp30">'+f[a].Time+'</td><td class="fn-widp30">'+f[a].User+"</td><td>"+tl(f[a].Type)+"</td>",c+="</tr>";c+="</table>";$("logManage_log_info_list").innerHTML=c;$$("#logManage_log_info_list tr").addEvent("click",function(){var b=this.id.replace(/[^\d]/g,"")-0;h(b)});$("logManage_current_page_label").setProperty("text",b)}function h(b){var c;
if(k!=-1&&(c="logInfoList_",c+=k,$(c)))k%2?$(c).className="none":($(c).removeClass("ui-table-tr-current"),$(c).addClass("ui-table-tr-odd"));k=b;c="logInfoList_";c+=k;$(c).className="ui-table-tr-current";if(!(b>f.length-1)){var a="";(new Hash(f[b].Detail)).each(function(b,c){a+=c+": "+(b||"")+"<br/>"});c="<table>";c+="<tbody>";c+='<tr><td><span class="fn-width80 ui-text">'+tl("w_Time")+':</span></td><td><span class="ui-text">'+f[b].Time+"</span></td></tr>";c+='<tr><td><span class="fn-width80 ui-text">'+
tl("w_User")+':</span></td><td><span class="ui-text">'+f[b].User+"</span></td></tr>";c+='<tr><td><span class="fn-width80 ui-text">'+tl("Type")+':</span></td><td><span class="ui-text">'+f[b].Type+"</span></td></tr>";c+='<tr><td><span class="fn-width80 ui-text">'+tl("Content")+':</span></td><td><span class="ui-text fn-word-wrap">'+a+"</span></td></tr>";c+="</tbody>";c+="</table>";$("logManage_system_log_info_list").innerHTML=c}}function q(){a.logService.clear(function(b){a.g_dialog.close();JSON.decode(b).result?
(a._onSearchClick(),remarkDisplay("logManage_log_remark",tl("w_DelLogSucce"),3E3,0)):remarkDisplay("logManage_log_remark",tl("w_DelLogFail"),3E3,1)},!1)}var m=!1,g=-1,p=[],f=[],j=100,i=1,n=0,k=-1,r=[["StartUp","Abort","Exit","Restart","ShutDown","Reboot","Upgrade"],["SaveConfig","RecallConfig","Focus&Zoom"],["SetWorkDirType","ClearWorkDir","HotPlug","RecordMode","FTP.Status","Storage.Unmount","NFS.Status"],["EventStart","EventStop","EventPulse"],["FileAccess","FileAccessError","FileSearch","File.Access"],
["LogIn","LogOut","AddUser","DeleteUser","ModifyUser","AddGroup","DeleteGroup","ModifyGroup","Account.ModifyPwd"],["ClearLog"]],l=0,o=0,a=Page.logManageConfig.Tab.logmanage={init:function(){a.logService=new LogService;a.translate();a.bind()},translate:function(){$("logManage_begintime_label").set("text",tl("w_BeginTime"));$("logManage_endtime_label").set("text",tl("w_EndTime"));$("logManage_all_types_label").set("text",tl("w_All Type"));$("logManage_search").set("text",tl("w_Search"));$("logManage_find_label").set("text",
tl("w_Find"));$("logManage_log_label").set("text",tl("w_Logs"));$("logManage_log_time_label").set("text",tl("w_Logtime"));$("logManage_log_time_tdlabel").set("text",tl("w_Logtime"));$("logManage_log_index_label").set("text",tl("w_Numbers"));$("logManage_log_time_label").set("text",tl("w_Time"));$("logManage_log_user_label").set("text",tl("w_User"));$("logManage_log_event_label").set("text",tl("w_Event"));$("logManage_system_log_info_label").set("text",tl("w_sysloginfo"));$("logManage_begin_page").set("title",
tl("w_Index"));$("logManage_previous_page").set("title",tl("w_Pre-Record"));$("logManage_next_page").set("title",tl("w_Next Record"));$("logManage_end_page").set("title",tl("w_Last Page"));$("logManage_goto_label").set("text",tl("w_Jump To"));$("logManage_backup").set("text",tl("w_BACKUP"));$("logManage_clear").set("text",tl("w_Clean"));$("logManage_delete_log_info_label").set("text",tl("w_ConfirmDeleteLog"));$("logManage_delete_log_confirm").set("text",tl("Ok"));$("logManage_delete_log_cancel").set("text",
tl("w_Cancel"));$$("#logManage_delete_log h1").set("text",tl("DelLog"))},render:function(){o++;if(!checkAuthority("QueryLog")&&($("logManage_search").disabled=!0,$("logManage_backup").disabled=!0,$$("#logManage_search, #logManage_backup").addClass("ui-button-disabled").removeEvents("click"),!Browser.Platform.win))$("logManage_search").style.display="none",$("logManage_backup").style.display="none";if(!checkAuthority("DelLog"))$("logManage_clear").style.display="none";p=[tl("w_SysOpr"),tl("w_ConfigOpr"),
tl("w_DataOpr"),tl("w_EventOpr"),tl("w_VideoOpr"),tl("w_User Management"),tl("w_ClearOpr")];$("logManage_all_types").empty();$("logManage_all_types").options.add(new Option(tl("w_Check All")));p.each(function(b){$("logManage_all_types").options.add(new Option(b))});a.g_dialog&&a.g_dialog.close();$("logManage_search_result_logs_label").style.display="none";$("logManage_search_result_time_label").style.display="none";$("logManage_system_log_info_list").innerHTML="";$("logManage_log_info_list").innerHTML=
"";$("logManage_search").setProperty("text",tl("w_Search"));$("logManage_total_Page_label").setProperty("text","1");$("logManage_current_page_label").setProperty("text","1");a._getDate()},bind:function(){attachDateInput("logManage_begintime_date","logManage_begintime_time");attachDateInput("logManage_endtime_date","logManage_endtime_time");$("logManage_begintime_date0").addEvent("blur",function(){a._onTimeIntervalControl("logManage_begintime_date","logManage_endtime_date")});$("logManage_begintime_date1").addEvent("blur",
function(){a._onTimeIntervalControl("logManage_begintime_date","logManage_endtime_date")});$("logManage_begintime_date2").addEvent("blur",function(){a._onTimeIntervalControl("logManage_begintime_date","logManage_endtime_date")});$("logManage_endtime_date0").addEvent("blur",function(){a._onTimeIntervalControl("logManage_begintime_date","logManage_endtime_date")});$("logManage_endtime_date1").addEvent("blur",function(){a._onTimeIntervalControl("logManage_begintime_date","logManage_endtime_date")});
$("logManage_endtime_date2").addEvent("blur",function(){a._onTimeIntervalControl("logManage_begintime_date","logManage_endtime_date")});$("logManage_begintime_time0").addEvent("blur",function(){a._onTimeIntervalControl("logManage_begintime_time","logManage_endtime_time")});$("logManage_begintime_time1").addEvent("blur",function(){a._onTimeIntervalControl("logManage_begintime_time","logManage_endtime_time")});$("logManage_begintime_time2").addEvent("blur",function(){a._onTimeIntervalControl("logManage_begintime_time",
"logManage_endtime_time")});$("logManage_endtime_time0").addEvent("blur",function(){a._onTimeIntervalControl("logManage_begintime_time","logManage_endtime_time")});$("logManage_endtime_time1").addEvent("blur",function(){a._onTimeIntervalControl("logManage_begintime_time","logManage_endtime_time")});$("logManage_endtime_time2").addEvent("blur",function(){a._onTimeIntervalControl("logManage_begintime_time","logManage_endtime_time")});$("logManage_search").addEvent("click",a._onSearchClick);$("logManage_begin_page").addEvent("click",
function(){a._onPageSearchClick(1)});$("logManage_previous_page").addEvent("click",a._onPreSearchClick);$("logManage_next_page").addEvent("click",a._onNextSearchClick);$("logManage_end_page").addEvent("click",function(){a._onPageSearchClick($("logManage_total_Page_label").getProperty("text")-0)});$("logManage_page_index").addEvent("keyup",function(){limit($("logManage_page_index"),$("logManage_total_Page_label").getProperty("text")-0);if(this.value=="0")this.value=1}).addEvent("blur",function(){limit($("logManage_page_index"),
$("logManage_total_Page_label").getProperty("text")-0);if(this.value=="0")this.value=1});$("logManage_goto_page").addEvent("click",function(){if($("logManage_page_index").value!=""){var b=$("logManage_page_index").value-0;a._onPageSearchClick(b)}});$("logManage_backup").addEvent("click",a._onBackupLogClick);$("logManage_clear").addEvent("click",function(){a.g_dialog.show()});a.g_dialog=new Dialog("logManage_delete_log",q,"logManage_delete_log_confirm","logManage_delete_log_cancel",tl("DelLog"));a.g_dialog.setPosition(400,
200)},_onTimeIntervalControl:function(b,c){var a=!1;if($("logManage_endtime_date0").value==$("logManage_begintime_date0").value&&($("logManage_endtime_date1").value==$("logManage_begintime_date1").value&&(a=$("logManage_endtime_date2").value-0>$("logManage_begintime_date2").value-0?!0:!1),$("logManage_endtime_date1").value-0>$("logManage_begintime_date1").value-0))return;if(!($("logManage_endtime_date0").value-0>$("logManage_begintime_date0").value-0)){if($("logManage_endtime_time0").value-0<$("logManage_begintime_time0").value-
0&&!a)$("logManage_endtime_time0").value=$("logManage_begintime_time0").value,$("logManage_endtime_time1").value=$("logManage_begintime_time1").value,$("logManage_endtime_time2").value=$("logManage_begintime_time2").value,$("logManage_endtime_date2").value=$("logManage_begintime_date2").value;if(!a){if($(c+"0").value-0<=$(b+"0").value-0&&($(c+"0").value=$(b+"0").value,$(c+"1").value-0<=$(b+"1").value-0&&($(c+"1").value=$(b+"1").value,$(c+"2").value-0<$(b+"2").value-0)))$(c+"2").value=$(b+"2").value;
if(b=="logManage_begintime_date"&&$(b+"0").value==$(c+"0").value&&$(b+"1").value==$(c+"1").value&&$(b+"2").value==$(c+"2").value){if($("logManage_endtime_time0").value-0<$("logManage_begintime_time0").value-0)$("logManage_endtime_time0").value=$("logManage_begintime_time0").value;if($("logManage_endtime_time1").value-0<$("logManage_begintime_time1").value-0)$("logManage_endtime_time1").value=$("logManage_begintime_time1").value;if($("logManage_endtime_time2").value-0<$("logManage_begintime_time2").value-
0)$("logManage_endtime_time2").value=$("logManage_begintime_time2").value}for(a=0;a<3;a++){if($(b+a).value.length==1)$(b+a).value=0+$(b+a).value;if($(c+a).value.length==1)$(c+a).value=0+$(c+a).value}}}},_getDate:function(){var b=new Date,a=b.getFullYear();b.getDate()<2?b.getMonth()<1?($("logManage_begintime_date0").value=a-1,$("logManage_begintime_date1").value=12,$("logManage_begintime_date2").value=31):($("logManage_begintime_date0").value=a,$("logManage_begintime_date1").value=chk10(b.getMonth()),
$("logManage_begintime_date2").value=getMonthDay("logManage_begintime_date")):($("logManage_begintime_date0").value=a,$("logManage_begintime_date1").value=chk10(b.getMonth()+1),$("logManage_begintime_date2").value=chk10(b.getDate()-1));$("logManage_endtime_date0").value=a;$("logManage_endtime_date1").value=chk10(b.getMonth()+1);$("logManage_endtime_date2").value=chk10(b.getDate());$("logManage_begintime_time0").value=chk10(b.getHours());$("logManage_begintime_time1").value=chk10(b.getMinutes());$("logManage_begintime_time2").value=
chk10(b.getSeconds());$("logManage_endtime_time0").value=chk10(b.getHours());$("logManage_endtime_time1").value=chk10(b.getMinutes());$("logManage_endtime_time2").value=chk10(b.getSeconds())},_onSearchClick:function(){if(checkAuthority("QueryLog"))if(o++,$("logManage_search").removeEvents("click"),$("logManage_search").getProperty("text")==tl("Stop"))a.logService.stopFind(g,d,!1),$("logManage_search").addEvent("click",a._onSearchClick);else{m&&a.logService.stopFind(g,d,!1);$("logManage_number_label").setProperty("text",
0);$("logManage_total_Page_label").setProperty("text","1");$("logManage_current_page_label").setProperty("text","1");$("logManage_log_info_list").innerHTML="";$("logManage_system_log_info_list").innerHTML="";m=!1;g=-1;f=[];l=0;i=1;n=0;k=-1;var b=$("logManage_begintime_date0").value+"-"+$("logManage_begintime_date1").value+"-"+$("logManage_begintime_date2").value+" "+$("logManage_begintime_time0").value+":"+$("logManage_begintime_time1").value+":"+$("logManage_begintime_time2").value,c=$("logManage_endtime_date0").value+
"-"+$("logManage_endtime_date1").value+"-"+$("logManage_endtime_date2").value+" "+$("logManage_endtime_time0").value+":"+$("logManage_endtime_time1").value+":"+$("logManage_endtime_time2").value;$("logManage_log_begintime_label").setProperty("text",b);$("logManage_log_endtime_label").setProperty("text",c);var h='{"StartTime" : "'+b+'","EndTime" : "'+c+'","Order" : "Descent","Types" : '+JSON.encode(r[$("logManage_all_types").selectedIndex-1])+',"Translate" : true}';g=a.logService.getLogToken($("logManage_all_types").selectedIndex>
0?h:'{"StartTime" : "'+b+'","EndTime" : "'+c+'","Order" : "Descent","Translate" : true}');$("logManage_search_result_time_label").style.display="none";g<=0?($("logManage_search_result_logs_label").style.display="block",e(i),g==0?remarkDisplay("logManage_log_remark",tl("w_NoQueryLog"),3E3,2):remarkDisplay("logManage_log_remark",tl("w_QueryLogFail"),3E3,1),$("logManage_search").addEvent("click",a._onSearchClick)):a._getList()}},_onPreSearchClick:function(){$("logManage_current_page_label").getProperty("text")-
0!=1&&g>-1&&(i--,e(i))},_onNextSearchClick:function(){$("logManage_current_page_label").getProperty("text")!=$("logManage_total_Page_label").getProperty("text")&&g>-1&&(i++,e(i))},_onPageSearchClick:function(b){var a=$("logManage_total_Page_label").getProperty("text")-0,b=b>a?a:b,b=b<1?1:b;i==b&&f.length>=b*j||(i=b,e(i))},_onBackupLogClick:function(){var a=new Date,c=a.getFullYear(),d=a.getMonth()+1,a=a.getDate(),c=c+"-"+d+"-"+a;$("ocx")&&($("ocx").SetFilename("LogBackup"+c+".txt"),$("ocx").SetFilter("Log Files (*.txt)|*.txt||"),
$("ocx").ShowSave())},_getLogBackFile:function(a,c){$("logManage_log_remark").setStyle("opacity","100");remarkDisplay("logManage_log_remark",tl("w_waiting"),1E4,0);var d=tl("w_Numbers")+"\t"+tl("w_User")+"\t"+tl("Time")+"\t\t\t"+tl("Type")+"\t"+tl("Content")+"\n";f.each(function(a,b){d+=b+1+"\t"+a.User+"\t"+a.Time+"\t"+tl(a.Type)+"\t"+JSON.encode(a.Detail)+"\n"});Site.currentPage.is.logManageConfig&&($("ocx")&&$("ocx").WriteFile(c,d,"w+"),remarkDisplay("logManage_log_remark",tl("Succeed in saving configure"),
3E3,0))},_getList:function(){l=0;f=[];$("logManage_search_result_logs_label").style.display="block";$("logManage_search").setProperty("text",tl("Stop"));$("logManage_search").addEvent("click",a._onSearchClick);var b=function(c){if(b.searchId==o)if(n=0,m=!0,Site.currentPage.is.logManageConfig){if(JSON.decode(c).result){var h=JSON.decode(c).params.found;h<j?(JSON.decode(c).params.items&&f.combine(JSON.decode(c).params.items),a.logService.stopFind(g,d,!1)):f.combine(JSON.decode(c).params.items);n=h}else a.logService.stopFind(g,
d,!1),remarkDisplay("logManage_log_remark",tl("w_QueryLogFail"),3E3,1);l+=n;if(n)$("logManage_search_result_time_label").style.display="block",c=$("logManage_number_label").getProperty("text")-0,$("logManage_number_label").setProperty("text",l),$("logManage_log_begintime_label").setProperty("text",f[l-1].Time),$("logManage_log_endtime_label").setProperty("text",f[0].Time),e(i),$("logManage_total_Page_label").setProperty("text",Math.ceil(l/j)),c==$("logManage_number_label").getProperty("text")-0?a.logService.stopFind(g,
d,!1):m&&a.logService.doFind(g,j,b)}else a.logService.stopFind(g,d,!1)};b.searchId=o;a.logService.doFind(g,j,b)}}})();(function(){var d=null,e=Page.logManageConfig.Tab.syslog={init:function(){e.configManager=new ConfigManager;e.translate();e.bind()},translate:function(){$("logManage_teleLog_enable_label").set("text",tl("C_On"));$("logManage_teleLog_ip_label").set("text",tl("w_IP Address"));$("logManage_teleLog_port_label").set("text",tl("w_Port"));$("logManage_telelog_refresh").set("text",tl("w_Refresh"));
$("logManage_telelog_confirm").set("text",tl("w_Confirm"))},render:function(){e.configManager.getConfig("SysLogServer",function(h){d=getTable(h);e._renderElements()})},bind:function(){attachLimit("logManage_teleLog_port",1,65534);attachIpInput("logManage_address_");$("logManage_telelog_confirm").addEvent("click",e._saveSyslog);$("logManage_telelog_refresh").addEvent("click",e._refreshSyslog)},_renderElements:function(){$("logManage_teleLog_enable").checked=d.Enable;d.Address.split(".").each(function(d,
e){$("logManage_address_"+e).value=d});$("logManage_teleLog_port").value=d.Port},_saveSyslog:function(){d.Enable=$("logManage_teleLog_enable").checked;d.Address=$("logManage_address_0").value+"."+$("logManage_address_1").value+"."+$("logManage_address_2").value+"."+$("logManage_address_3").value;d.Port=$("logManage_teleLog_port").value-0;e.configManager.setConfig("SysLogServer",d,function(d){JSON.decode(d).result?remarkDisplay("logManage_telelog_remark",tl("Succeed in saving configure"),3E3,0):remarkDisplay("logManage_telelog_remark",
tl("Saving failure"),3E3,1)})},_refreshSyslog:function(){e.configManager.getConfig("SysLogServer",function(h){JSON.decode(h).result?(d=getTable(h),e._renderElements(),remarkDisplay("logManage_telelog_remark",tl("Operateingsuccess"),3E3,0)):remarkDisplay("logManage_telelog_remark",tl("Operateingfailure"),3E3,1)})}}})()})();
